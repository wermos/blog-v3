import{f as V,p as Lt}from"./flowDb-956e92f1.DA2uARwf.js";import{h as S,f as tt,G as _t}from"./graph.BnUrNHf9.js";import{d as x,n as U,l as R,g as G,o as Et,p as Y,q as z,r as et,t as rt,k as at}from"./mermaid.core.DP-vum00.js";import{u as Tt,r as Nt,p as At,l as Ct,d as M}from"./layout.CoDst8Rm.js";import{a as N,b as nt,i as st,c as E,e as it,d as ot,f as It,g as Bt,s as Mt}from"./styles-c10674c1.C7S0YUip.js";import{l as Dt}from"./line.D6KgGKHR.js";import"./page.D2yfJ-p-.js";import"./_commonjsHelpers.Cpj98o6Y.js";import"./index-3862675e.MblMW_9u.js";import"./clone.CRyzRn2C.js";import"./edges-e0da2a9e.PNeX2f5R.js";import"./createText-2e5e7dd3.yFlWzZJQ.js";import"./channel.BZSxN5ei.js";import"./array.BKyUJesY.js";import"./path.CbwjOpE9.js";function Rt(t){if(!t.ok)throw new Error(t.status+" "+t.statusText);return t.text()}function Gt(t,e){return fetch(t,e).then(Rt)}function Pt(t){return(e,r)=>Gt(e,r).then((e=>(new DOMParser).parseFromString(e,t)))}var Ut=Pt("image/svg+xml"),H={normal:Wt,vee:Vt,undirected:zt};function $t(t){H=t}function Wt(t,e,r,a){var n=t.append("marker").attr("id",e).attr("viewBox","0 0 10 10").attr("refX",9).attr("refY",5).attr("markerUnits","strokeWidth").attr("markerWidth",8).attr("markerHeight",6).attr("orient","auto").append("path").attr("d","M 0 0 L 10 5 L 0 10 z").style("stroke-width",1).style("stroke-dasharray","1,0");N(n,r[a+"Style"]),r[a+"Class"]&&n.attr("class",r[a+"Class"])}function Vt(t,e,r,a){var n=t.append("marker").attr("id",e).attr("viewBox","0 0 10 10").attr("refX",9).attr("refY",5).attr("markerUnits","strokeWidth").attr("markerWidth",8).attr("markerHeight",6).attr("orient","auto").append("path").attr("d","M 0 0 L 10 5 L 0 10 L 4 5 z").style("stroke-width",1).style("stroke-dasharray","1,0");N(n,r[a+"Style"]),r[a+"Class"]&&n.attr("class",r[a+"Class"])}function zt(t,e,r,a){var n=t.append("marker").attr("id",e).attr("viewBox","0 0 10 10").attr("refX",9).attr("refY",5).attr("markerUnits","strokeWidth").attr("markerWidth",8).attr("markerHeight",6).attr("orient","auto").append("path").attr("d","M 0 5 L 10 5").style("stroke-width",1).style("stroke-dasharray","1,0");N(n,r[a+"Style"]),r[a+"Class"]&&n.attr("class",r[a+"Class"])}function Yt(t,e){var r=t;return r.node().appendChild(e.label),N(r,e.labelStyle),r}function Ht(t,e){for(var r=t.append("text"),a=Xt(e.label).split("\n"),n=0;n<a.length;n++)r.append("tspan").attr("xml:space","preserve").attr("dy","1em").attr("x","1").text(a[n]);return N(r,e.labelStyle),r}function Xt(t){for(var e,r="",a=!1,n=0;n<t.length;++n)if(e=t[n],a){if("n"===e)r+="\n";else r+=e;a=!1}else"\\"===e?a=!0:r+=e;return r}function J(t,e,r){var a=e.label,n=t.append("g");"svg"===e.labelType?Yt(n,e):"string"!=typeof a||"html"===e.labelType?nt(n,e):Ht(n,e);var i,s=n.node().getBBox();switch(r){case"top":i=-e.height/2;break;case"bottom":i=e.height/2-s.height;break;default:i=-s.height/2}return n.attr("transform","translate("+-s.width/2+","+i+")"),n}var X=function(t,e){var r=e.nodes().filter((function(t){return st(e,t)})),a=t.selectAll("g.cluster").data(r,(function(t){return t}));E(a.exit(),e).style("opacity",0).remove();var n=a.enter().append("g").attr("class","cluster").attr("id",(function(t){return e.node(t).id})).style("opacity",0).each((function(t){var r=e.node(t),a=x(this);x(this).append("rect"),J(a.append("g").attr("class","label"),r,r.clusterLabelPos)}));return a=a.merge(n),(a=E(a,e).style("opacity",1)).selectAll("rect").each((function(t){var r=e.node(t),a=x(this);N(a,r.style)})),a};function Ft(t){X=t}let F=function(t,e){var r,a=t.selectAll("g.edgeLabel").data(e.edges(),(function(t){return it(t)})).classed("update",!0);return a.exit().remove(),a.enter().append("g").classed("edgeLabel",!0).style("opacity",0),(a=t.selectAll("g.edgeLabel")).each((function(t){var r=x(this);r.select(".label").remove();var a=e.edge(t),n=J(r,e.edge(t),0).classed("label",!0),i=n.node().getBBox();a.labelId&&n.attr("id",a.labelId),S(a,"width")||(a.width=i.width),S(a,"height")||(a.height=i.height)})),r=a.exit?a.exit():a.selectAll(null),E(r,e).style("opacity",0).remove(),a};function qt(t){F=t}function O(t,e){return t.intersect(e)}var q=function(t,e,r){var a=t.selectAll("g.edgePath").data(e.edges(),(function(t){return it(t)})).classed("update",!0),n=Ot(a,e);jt(a,e);var i=void 0!==a.merge?a.merge(n):a;return E(i,e).style("opacity",1),i.each((function(t){var r=x(this),a=e.edge(t);a.elem=this,a.id&&r.attr("id",a.id),ot(r,a.class,(r.classed("update")?"update ":"")+"edgePath")})),i.selectAll("path.path").each((function(t){var r=e.edge(t);r.arrowheadId=Tt("arrowhead");var a=x(this).attr("marker-end",(function(){return"url("+Kt(location.href,r.arrowheadId)+")"})).style("fill","none");E(a,e).attr("d",(function(t){return Jt(e,t)})),N(a,r.style)})),i.selectAll("defs *").remove(),i.selectAll("defs").each((function(t){var a=e.edge(t);(0,r[a.arrowhead])(x(this),a.arrowheadId,a,"arrowhead")})),i};function Qt(t){q=t}function Kt(t,e){return t.split("#")[0]+"#"+e}function Jt(t,e){var r=t.edge(e),a=t.node(e.v),n=t.node(e.w),i=r.points.slice(1,r.points.length-1);return i.unshift(O(a,i[0])),i.push(O(n,i[i.length-1])),lt(r,i)}function lt(t,e){var r=(Dt||Ut.line)().x((function(t){return t.x})).y((function(t){return t.y}));return(r.curve||r.interpolate)(t.curve),r(e)}function Zt(t){var e=t.getBBox(),r=t.ownerSVGElement.getScreenCTM().inverse().multiply(t.getScreenCTM()).translate(e.width/2,e.height/2);return{x:r.e,y:r.f}}function Ot(t,e){var r=t.enter().append("g").attr("class","edgePath").style("opacity",0);return r.append("path").attr("class","path").attr("d",(function(t){var r=e.edge(t),a=e.node(t.v).elem;return lt(r,Nt(r.points.length).map((function(){return Zt(a)})))})),r.append("defs"),r}function jt(t,e){var r=t.exit();E(r,e).style("opacity",0).remove()}var Q=function(t,e,r){var a,n=e.nodes().filter((function(t){return!st(e,t)})),i=t.selectAll("g.node").data(n,(function(t){return t})).classed("update",!0);return i.exit().remove(),i.enter().append("g").attr("class","node").style("opacity",0),(i=t.selectAll("g.node")).each((function(t){var a=e.node(t),n=x(this);ot(n,a.class,(n.classed("update")?"update ":"")+"node"),n.select("g.label").remove();var i=n.append("g").attr("class","label"),s=J(i,a),o=r[a.shape],l=At(s.node().getBBox(),"width","height");a.elem=this,a.id&&n.attr("id",a.id),a.labelId&&i.attr("id",a.labelId),S(a,"width")&&(l.width=a.width),S(a,"height")&&(l.height=a.height),l.width+=a.paddingLeft+a.paddingRight,l.height+=a.paddingTop+a.paddingBottom,i.attr("transform","translate("+(a.paddingLeft-a.paddingRight)/2+","+(a.paddingTop-a.paddingBottom)/2+")");var d=x(this);d.select(".label-container").remove();var c=o(d,l,a).classed("label-container",!0);N(c,a.style);var h=c.node().getBBox();a.width=h.width,a.height=h.height})),a=i.exit?i.exit():i.selectAll(null),E(a,e).style("opacity",0).remove(),i};function te(t){Q=t}function ee(t,e){var r=t.filter((function(){return!x(this).classed("update")}));function a(t){var r=e.node(t);return"translate("+r.x+","+r.y+")"}r.attr("transform",a),E(t,e).style("opacity",1).attr("transform",a),E(r.selectAll("rect"),e).attr("width",(function(t){return e.node(t).width})).attr("height",(function(t){return e.node(t).height})).attr("x",(function(t){return-e.node(t).width/2})).attr("y",(function(t){return-e.node(t).height/2}))}function re(t,e){function r(t){var r=e.edge(t);return S(r,"x")?"translate("+r.x+","+r.y+")":""}t.filter((function(){return!x(this).classed("update")})).attr("transform",r),E(t,e).style("opacity",1).attr("transform",r)}function ae(t,e){function r(t){var r=e.node(t);return"translate("+r.x+","+r.y+")"}t.filter((function(){return!x(this).classed("update")})).attr("transform",r),E(t,e).style("opacity",1).attr("transform",r)}function ct(t,e,r,a){var n=t.x,i=t.y,s=n-a.x,o=i-a.y,l=Math.sqrt(e*e*o*o+r*r*s*s),d=Math.abs(e*r*s/l);a.x<n&&(d=-d);var c=Math.abs(e*r*o/l);return a.y<i&&(c=-c),{x:n+d,y:i+c}}function ne(t,e,r){return ct(t,e,e,r)}function se(t,e,r,a){var n,i,s,o,l,d,c,h,u,p,f,g,y;if(n=e.y-t.y,s=t.x-e.x,l=e.x*t.y-t.x*e.y,u=n*r.x+s*r.y+l,p=n*a.x+s*a.y+l,!(0!==u&&0!==p&&j(u,p)||(i=a.y-r.y,o=r.x-a.x,d=a.x*r.y-r.x*a.y,c=i*t.x+o*t.y+d,h=i*e.x+o*e.y+d,0!==c&&0!==h&&j(c,h)||(f=n*o-i*s,0===f))))return g=Math.abs(f/2),{x:(y=s*d-o*l)<0?(y-g)/f:(y+g)/f,y:(y=i*l-n*d)<0?(y-g)/f:(y+g)/f}}function j(t,e){return t*e>0}function T(t,e,r){var a=t.x,n=t.y,i=[],s=Number.POSITIVE_INFINITY,o=Number.POSITIVE_INFINITY;e.forEach((function(t){s=Math.min(s,t.x),o=Math.min(o,t.y)}));for(var l=a-t.width/2-s,d=n-t.height/2-o,c=0;c<e.length;c++){var h=e[c],u=e[c<e.length-1?c+1:0],p=se(t,r,{x:l+h.x,y:d+h.y},{x:l+u.x,y:d+u.y});p&&i.push(p)}return i.length?(i.length>1&&i.sort((function(t,e){var a=t.x-r.x,n=t.y-r.y,i=Math.sqrt(a*a+n*n),s=e.x-r.x,o=e.y-r.y,l=Math.sqrt(s*s+o*o);return i<l?-1:i===l?0:1})),i[0]):(console.log("NO INTERSECTION FOUND, RETURN NODE CENTER",t),t)}function Z(t,e){var r,a,n=t.x,i=t.y,s=e.x-n,o=e.y-i,l=t.width/2,d=t.height/2;return Math.abs(o)*l>Math.abs(s)*d?(o<0&&(d=-d),r=0===o?0:d*s/o,a=d):(s<0&&(l=-l),r=l,a=0===s?0:l*o/s),{x:n+r,y:i+a}}var K={rect:oe,ellipse:le,circle:ce,diamond:de};function ie(t){K=t}function oe(t,e,r){var a=t.insert("rect",":first-child").attr("rx",r.rx).attr("ry",r.ry).attr("x",-e.width/2).attr("y",-e.height/2).attr("width",e.width).attr("height",e.height);return r.intersect=function(t){return Z(r,t)},a}function le(t,e,r){var a=e.width/2,n=e.height/2,i=t.insert("ellipse",":first-child").attr("x",-e.width/2).attr("y",-e.height/2).attr("rx",a).attr("ry",n);return r.intersect=function(t){return ct(r,a,n,t)},i}function ce(t,e,r){var a=Math.max(e.width,e.height)/2,n=t.insert("circle",":first-child").attr("x",-e.width/2).attr("y",-e.height/2).attr("r",a);return r.intersect=function(t){return ne(r,a,t)},n}function de(t,e,r){var a=e.width*Math.SQRT2/2,n=e.height*Math.SQRT2/2,i=[{x:0,y:-n},{x:-a,y:0},{x:0,y:n},{x:a,y:0}],s=t.insert("polygon",":first-child").attr("points",i.map((function(t){return t.x+","+t.y})).join(" "));return r.intersect=function(t){return T(r,i,t)},s}function he(){var t=function(t,e){pe(e);var r=D(t,"output"),a=D(r,"clusters"),n=D(r,"edgePaths"),i=F(D(r,"edgeLabels"),e),s=Q(D(r,"nodes"),e,K);Ct(e),ae(s,e),re(i,e),q(n,e,H),ee(X(a,e),e),ve(e)};return t.createNodes=function(e){return arguments.length?(te(e),t):Q},t.createClusters=function(e){return arguments.length?(Ft(e),t):X},t.createEdgeLabels=function(e){return arguments.length?(qt(e),t):F},t.createEdgePaths=function(e){return arguments.length?(Qt(e),t):q},t.shapes=function(e){return arguments.length?(ie(e),t):K},t.arrows=function(e){return arguments.length?($t(e),t):H},t}var ue={paddingLeft:10,paddingRight:10,paddingTop:10,paddingBottom:10,rx:0,ry:0,shape:"rect"},fe={arrowhead:"normal",curve:U};function pe(t){t.nodes().forEach((function(e){var r=t.node(e);!S(r,"label")&&!t.children(e).length&&(r.label=e),S(r,"paddingX")&&M(r,{paddingLeft:r.paddingX,paddingRight:r.paddingX}),S(r,"paddingY")&&M(r,{paddingTop:r.paddingY,paddingBottom:r.paddingY}),S(r,"padding")&&M(r,{paddingLeft:r.padding,paddingRight:r.padding,paddingTop:r.padding,paddingBottom:r.padding}),M(r,ue),tt(["paddingLeft","paddingRight","paddingTop","paddingBottom"],(function(t){r[t]=Number(r[t])})),S(r,"width")&&(r._prevWidth=r.width),S(r,"height")&&(r._prevHeight=r.height)})),t.edges().forEach((function(e){var r=t.edge(e);S(r,"label")||(r.label=""),M(r,fe)}))}function ve(t){tt(t.nodes(),(function(e){var r=t.node(e);S(r,"_prevWidth")?r.width=r._prevWidth:delete r.width,S(r,"_prevHeight")?r.height=r._prevHeight:delete r.height,delete r._prevWidth,delete r._prevHeight}))}function D(t,e){var r=t.select("g."+e);return r.empty()&&(r=t.append("g").attr("class",e)),r}function dt(t,e,r){const a=.9*(e.width+e.height),n=[{x:a/2,y:0},{x:a,y:-a/2},{x:a/2,y:-a},{x:0,y:-a/2}],i=A(t,a,a,n);return r.intersect=function(t){return T(r,n,t)},i}function ht(t,e,r){const a=e.height,n=a/4,i=e.width+2*n,s=[{x:n,y:0},{x:i-n,y:0},{x:i,y:-a/2},{x:i-n,y:-a},{x:n,y:-a},{x:0,y:-a/2}],o=A(t,i,a,s);return r.intersect=function(t){return T(r,s,t)},o}function ut(t,e,r){const a=e.width,n=e.height,i=[{x:-n/2,y:0},{x:a,y:0},{x:a,y:-n},{x:-n/2,y:-n},{x:0,y:-n/2}],s=A(t,a,n,i);return r.intersect=function(t){return T(r,i,t)},s}function ft(t,e,r){const a=e.width,n=e.height,i=[{x:-2*n/6,y:0},{x:a-n/6,y:0},{x:a+2*n/6,y:-n},{x:n/6,y:-n}],s=A(t,a,n,i);return r.intersect=function(t){return T(r,i,t)},s}function pt(t,e,r){const a=e.width,n=e.height,i=[{x:2*n/6,y:0},{x:a+n/6,y:0},{x:a-2*n/6,y:-n},{x:-n/6,y:-n}],s=A(t,a,n,i);return r.intersect=function(t){return T(r,i,t)},s}function vt(t,e,r){const a=e.width,n=e.height,i=[{x:-2*n/6,y:0},{x:a+2*n/6,y:0},{x:a-n/6,y:-n},{x:n/6,y:-n}],s=A(t,a,n,i);return r.intersect=function(t){return T(r,i,t)},s}function gt(t,e,r){const a=e.width,n=e.height,i=[{x:n/6,y:0},{x:a-n/6,y:0},{x:a+2*n/6,y:-n},{x:-2*n/6,y:-n}],s=A(t,a,n,i);return r.intersect=function(t){return T(r,i,t)},s}function yt(t,e,r){const a=e.width,n=e.height,i=[{x:0,y:0},{x:a+n/2,y:0},{x:a,y:-n/2},{x:a+n/2,y:-n},{x:0,y:-n}],s=A(t,a,n,i);return r.intersect=function(t){return T(r,i,t)},s}function wt(t,e,r){const a=e.height,n=e.width+a/4,i=t.insert("rect",":first-child").attr("rx",a/2).attr("ry",a/2).attr("x",-n/2).attr("y",-a/2).attr("width",n).attr("height",a);return r.intersect=function(t){return Z(r,t)},i}function mt(t,e,r){const a=e.width,n=e.height,i=[{x:0,y:0},{x:a,y:0},{x:a,y:-n},{x:0,y:-n},{x:0,y:0},{x:-8,y:0},{x:a+8,y:0},{x:a+8,y:-n},{x:-8,y:-n},{x:-8,y:0}],s=A(t,a,n,i);return r.intersect=function(t){return T(r,i,t)},s}function xt(t,e,r){const a=e.width,n=a/2,i=n/(2.5+a/50),s=e.height+i,o="M 0,"+i+" a "+n+","+i+" 0,0,0 "+a+" 0 a "+n+","+i+" 0,0,0 "+-a+" 0 l 0,"+s+" a "+n+","+i+" 0,0,0 "+a+" 0 l 0,"+-s,l=t.attr("label-offset-y",i).insert("path",":first-child").attr("d",o).attr("transform","translate("+-a/2+","+-(s/2+i)+")");return r.intersect=function(t){const e=Z(r,t),a=e.x-r.x;if(0!=n&&(Math.abs(a)<r.width/2||Math.abs(a)==r.width/2&&Math.abs(e.y-r.y)>r.height/2-i)){let s=i*i*(1-a*a/(n*n));0!=s&&(s=Math.sqrt(s)),s=i-s,t.y-r.y>0&&(s=-s),e.y+=s}return e},l}function ge(t){t.shapes().question=dt,t.shapes().hexagon=ht,t.shapes().stadium=wt,t.shapes().subroutine=mt,t.shapes().cylinder=xt,t.shapes().rect_left_inv_arrow=ut,t.shapes().lean_right=ft,t.shapes().lean_left=pt,t.shapes().trapezoid=vt,t.shapes().inv_trapezoid=gt,t.shapes().rect_right_inv_arrow=yt}function ye(t){t({question:dt}),t({hexagon:ht}),t({stadium:wt}),t({subroutine:mt}),t({cylinder:xt}),t({rect_left_inv_arrow:ut}),t({lean_right:ft}),t({lean_left:pt}),t({trapezoid:vt}),t({inv_trapezoid:gt}),t({rect_right_inv_arrow:yt})}function A(t,e,r,a){return t.insert("polygon",":first-child").attr("points",a.map((function(t){return t.x+","+t.y})).join(" ")).attr("transform","translate("+-e/2+","+r/2+")")}const we={addToRender:ge,addToRenderV2:ye},bt={},me=function(t){const e=Object.keys(t);for(const r of e)bt[r]=t[r]},kt=async function(t,e,r,a,n,i){const s=a?a.select(`[id="${r}"]`):x(`[id="${r}"]`),o=n||document,l=Object.keys(t);for(const r of l){const a=t[r];let n="default";a.classes.length>0&&(n=a.classes.join(" "));const l=Y(a.styles);let d,c=void 0!==a.text?a.text:a.id;if(et(G().flowchart.htmlLabels)){const t={label:await rt(c.replace(/fa[blrs]?:fa-[\w-]+/g,(t=>`<i class='${t.replace(":"," ")}'></i>`)),G())};d=nt(s,t).node(),d.parentNode.removeChild(d)}else{const t=o.createElementNS("http://www.w3.org/2000/svg","text");t.setAttribute("style",l.labelStyle.replace("color:","fill:"));const e=c.split(at.lineBreakRegex);for(const r of e){const e=o.createElementNS("http://www.w3.org/2000/svg","tspan");e.setAttributeNS("http://www.w3.org/XML/1998/namespace","xml:space","preserve"),e.setAttribute("dy","1em"),e.setAttribute("x","1"),e.textContent=r,t.appendChild(e)}d=t}let h=0,u="";switch(a.type){case"round":h=5,u="rect";break;case"square":case"group":default:u="rect";break;case"diamond":u="question";break;case"hexagon":u="hexagon";break;case"odd":case"odd_right":u="rect_left_inv_arrow";break;case"lean_right":u="lean_right";break;case"lean_left":u="lean_left";break;case"trapezoid":u="trapezoid";break;case"inv_trapezoid":u="inv_trapezoid";break;case"circle":u="circle";break;case"ellipse":u="ellipse";break;case"stadium":u="stadium";break;case"subroutine":u="subroutine";break;case"cylinder":u="cylinder"}R.warn("Adding node",a.id,a.domId),e.setNode(i.db.lookUpDomId(a.id),{labelType:"svg",labelStyle:l.labelStyle,shape:u,label:d,rx:h,ry:h,class:n,style:l.style,id:i.db.lookUpDomId(a.id)})}},St=async function(t,e,r){let a,n,i=0;if(void 0!==t.defaultStyle){const e=Y(t.defaultStyle);a=e.style,n=e.labelStyle}for(const s of t){i++;const o="L-"+s.start+"-"+s.end,l="LS-"+s.start,d="LE-"+s.end,c={};"arrow_open"===s.type?c.arrowhead="none":c.arrowhead="normal";let h="",u="";if(void 0!==s.style){const t=Y(s.style);h=t.style,u=t.labelStyle}else switch(s.stroke){case"normal":h="fill:none",void 0!==a&&(h=a),void 0!==n&&(u=n);break;case"dotted":h="fill:none;stroke-width:2px;stroke-dasharray:3;";break;case"thick":h=" stroke-width: 3.5px;fill:none"}c.style=h,c.labelStyle=u,void 0!==s.interpolate?c.curve=z(s.interpolate,U):void 0!==t.defaultInterpolate?c.curve=z(t.defaultInterpolate,U):c.curve=z(bt.curve,U),void 0===s.text?void 0!==s.style&&(c.arrowheadStyle="fill: #333"):(c.arrowheadStyle="fill: #333",c.labelpos="c",et(G().flowchart.htmlLabels)?(c.labelType="html",c.label=`<span id="L-${o}" class="edgeLabel L-${l}' L-${d}" style="${c.labelStyle}">${await rt(s.text.replace(/fa[blrs]?:fa-[\w-]+/g,(t=>`<i class='${t.replace(":"," ")}'></i>`)),G())}</span>`):(c.labelType="text",c.label=s.text.replace(at.lineBreakRegex,"\n"),void 0===s.style&&(c.style=c.style||"stroke: #333; stroke-width: 1.5px;fill:none"),c.labelStyle=c.labelStyle.replace("color:","fill:"))),c.id=o,c.class=l+" "+d,c.minlen=s.length||1,e.setEdge(r.db.lookUpDomId(s.start),r.db.lookUpDomId(s.end),c,i)}},xe=function(t,e){return R.info("Extracting classes"),e.db.getClasses()},be=async function(t,e,r,a){R.info("Drawing flowchart");const{securityLevel:n,flowchart:i}=G();let s;"sandbox"===n&&(s=x("#i"+e));const o=x("sandbox"===n?s.nodes()[0].contentDocument.body:"body"),l="sandbox"===n?s.nodes()[0].contentDocument:document;let d=a.db.getDirection();void 0===d&&(d="TD");const c=i.nodeSpacing||50,h=i.rankSpacing||50,u=new _t({multigraph:!0,compound:!0}).setGraph({rankdir:d,nodesep:c,ranksep:h,marginx:8,marginy:8}).setDefaultEdgeLabel((function(){return{}}));let p;const f=a.db.getSubGraphs();for(let t=f.length-1;t>=0;t--)p=f[t],a.db.addVertex(p.id,p.title,"group",void 0,p.classes);const g=a.db.getVertices();R.warn("Get vertices",g);const y=a.db.getEdges();let w=0;for(w=f.length-1;w>=0;w--){p=f[w],Mt("cluster").append("text");for(let t=0;t<p.nodes.length;t++)R.warn("Setting subgraph",p.nodes[t],a.db.lookUpDomId(p.nodes[t]),a.db.lookUpDomId(p.id)),u.setParent(a.db.lookUpDomId(p.nodes[t]),a.db.lookUpDomId(p.id))}await kt(g,u,e,o,l,a),await St(y,u,a);const m=new he;we.addToRender(m),m.arrows().none=function(t,e,r,a){const n=t.append("marker").attr("id",e).attr("viewBox","0 0 10 10").attr("refX",9).attr("refY",5).attr("markerUnits","strokeWidth").attr("markerWidth",8).attr("markerHeight",6).attr("orient","auto").append("path").attr("d","M 0 0 L 0 0 L 0 0 z");N(n,r[a+"Style"])},m.arrows().normal=function(t,e){t.append("marker").attr("id",e).attr("viewBox","0 0 10 10").attr("refX",9).attr("refY",5).attr("markerUnits","strokeWidth").attr("markerWidth",8).attr("markerHeight",6).attr("orient","auto").append("path").attr("d","M 0 0 L 10 5 L 0 10 z").attr("class","arrowheadPath").style("stroke-width",1).style("stroke-dasharray","1,0")};const b=o.select(`[id="${e}"]`),v=o.select("#"+e+" g");for(m(v,u),v.selectAll("g.node").attr("title",(function(){return a.db.getTooltip(this.id)})),a.db.indexNodes("subGraph"+w),w=0;w<f.length;w++)if(p=f[w],"undefined"!==p.title){const t=l.querySelectorAll("#"+e+' [id="'+a.db.lookUpDomId(p.id)+'"] rect'),r=l.querySelectorAll("#"+e+' [id="'+a.db.lookUpDomId(p.id)+'"]'),n=t[0].x.baseVal.value,i=t[0].y.baseVal.value,s=t[0].width.baseVal.value,o=x(r[0]).select(".label");o.attr("transform",`translate(${n+s/2}, ${i+14})`),o.attr("id",e+"Text");for(let t=0;t<p.classes.length;t++)r[0].classList.add(p.classes[t])}if(!i.htmlLabels){const t=l.querySelectorAll('[id="'+e+'"] .edgeLabel .label');for(const e of t){const t=e.getBBox(),r=l.createElementNS("http://www.w3.org/2000/svg","rect");r.setAttribute("rx",0),r.setAttribute("ry",0),r.setAttribute("width",t.width),r.setAttribute("height",t.height),e.insertBefore(r,e.firstChild)}}Et(u,b,i.diagramPadding,i.useMaxWidth),Object.keys(g).forEach((function(t){const r=g[t];if(r.link){const i=o.select("#"+e+' [id="'+a.db.lookUpDomId(t)+'"]');if(i){const t=l.createElementNS("http://www.w3.org/2000/svg","a");t.setAttributeNS("http://www.w3.org/2000/svg","class",r.classes.join(" ")),t.setAttributeNS("http://www.w3.org/2000/svg","href",r.link),t.setAttributeNS("http://www.w3.org/2000/svg","rel","noopener"),"sandbox"===n?t.setAttributeNS("http://www.w3.org/2000/svg","target","_top"):r.linkTarget&&t.setAttributeNS("http://www.w3.org/2000/svg","target",r.linkTarget);const e=i.insert((function(){return t}),":first-child"),a=i.select(".label-container");a&&e.append((function(){return a.node()}));const s=i.select(".label");s&&e.append((function(){return s.node()}))}}}))},ke={setConf:me,addVertices:kt,addEdges:St,getClasses:xe,draw:be},Ue={parser:Lt,db:V,renderer:Bt,styles:It,init:t=>{t.flowchart||(t.flowchart={}),t.flowchart.arrowMarkerAbsolute=t.arrowMarkerAbsolute,ke.setConf(t.flowchart),V.clear(),V.setGen("gen-1")}};export{Ue as diagram};