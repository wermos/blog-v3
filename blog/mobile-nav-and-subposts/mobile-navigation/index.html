<!DOCTYPE html><html class="bg-background text-foreground" lang="en-US"> <head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes"><meta name="generator" content="Astro v5.10.1"><meta name="HandheldFriendly" content="True"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="format-detection" content="telephone=no,date=no,address=no,email=no,url=no"><meta name="theme-color" content="#121212" media="(prefers-color-scheme: dark)"><meta name="theme-color" content="#121212" media="(prefers-color-scheme: light)"><link rel="sitemap" href="/sitemap-index.xml"><link rel="manifest" href="/site.webmanifest"><link rel="alternate" type="application/rss+xml" title="astro-erudite" href="https://wermos.github.io/rss.xml"><link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><link rel="shortcut icon" href="/favicon.ico"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><meta name="apple-mobile-web-app-title" content="astro-erudite"><link rel="manifest" href="/site.webmanifest"><meta name="astro-view-transitions-enabled" content="true"><meta name="astro-view-transitions-fallback" content="animate"><script type="module" src="/blog-v3/_astro/ClientRouter.astro_astro_type_script_index_0_lang.CtSceO8m.js"></script><title>Implementing sticky mobile navigation | astro-erudite</title><meta name="title" content="Implementing sticky mobile navigation | astro-erudite"><meta name="description" content="Technical deep-dive into the sticky mobile table of contents with progress tracking and smart section highlighting"><link rel="canonical" href="https://astro-erudite.vercel.app"><meta name="robots" content="noindex"><meta property="og:title" content="Implementing sticky mobile navigation"><meta property="og:description" content="Technical deep-dive into the sticky mobile table of contents with progress tracking and smart section highlighting"><meta property="og:image" content="https://wermos.github.io/static/1200x630.png"><meta property="og:image:alt" content="Implementing sticky mobile navigation"><meta property="og:type" content="website"><meta property="og:locale" content="en-US"><meta property="og:site_name" content="astro-erudite"><meta property="og:url" content="https://wermos.github.io/blog-v3/blog/mobile-nav-and-subposts/mobile-navigation/"><meta property="og:author" content="jktrn"><meta name="twitter:title" content="Implementing sticky mobile navigation"><meta name="twitter:description" content="Technical deep-dive into the sticky mobile table of contents with progress tracking and smart section highlighting"><meta property="twitter:image" content="https://wermos.github.io/static/1200x630.png"><meta name="twitter:image:alt" content="Implementing sticky mobile navigation"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:creator" content="jktrn"><meta property="article:tag" content="v1.6.0"><link rel="stylesheet" href="/blog-v3/_astro/about.DoiBgUSh.css"><script type="module" src="/blog-v3/_astro/page.NkZCoHH1.js"></script></head><body> <div class="flex h-fit min-h-screen flex-col gap-y-6 font-sans"> <div class="bg-background/50 sticky top-0 z-50 divide-y backdrop-blur-sm xl:divide-none"> <header data-astro-transition-persist="astro-l7r54iwe-1"> <div class="mx-auto flex max-w-3xl items-center justify-between gap-4 px-4 py-3"> <a href="/" target="_self" class="transition-colors duration-300 ease-in-out flex shrink-0 items-center justify-center gap-3">  <img src="/blog-v3/_astro/logo.DwvyYgWz_Z1cij1B.svg" alt="Logo" loading="lazy" decoding="async" fetchpriority="auto" width="512" height="512" class="size-5 sm:size-6"> <span class="hidden h-full text-lg font-medium min-[300px]:block">astro-erudite</span>  </a> <div class="flex items-center sm:gap-4"> <nav class="hidden items-center gap-4 text-sm sm:flex sm:gap-6"> <a href="/blog" target="_self" class="inline-block duration-300 ease-in-out text-foreground/60 hover:text-foreground/80 capitalize transition-colors"> blog </a><a href="/authors" target="_self" class="inline-block duration-300 ease-in-out text-foreground/60 hover:text-foreground/80 capitalize transition-colors"> authors </a><a href="/about" target="_self" class="inline-block duration-300 ease-in-out text-foreground/60 hover:text-foreground/80 capitalize transition-colors"> about </a> </nav> <style>astro-island,astro-slot,astro-static-slot{display:contents}</style><script>(()=>{var e=async t=>{await(await t())()};(self.Astro||(self.Astro={})).load=e;window.dispatchEvent(new Event("astro:load"));})();</script><script>(()=>{var A=Object.defineProperty;var g=(i,o,a)=>o in i?A(i,o,{enumerable:!0,configurable:!0,writable:!0,value:a}):i[o]=a;var d=(i,o,a)=>g(i,typeof o!="symbol"?o+"":o,a);{let i={0:t=>m(t),1:t=>a(t),2:t=>new RegExp(t),3:t=>new Date(t),4:t=>new Map(a(t)),5:t=>new Set(a(t)),6:t=>BigInt(t),7:t=>new URL(t),8:t=>new Uint8Array(t),9:t=>new Uint16Array(t),10:t=>new Uint32Array(t),11:t=>1/0*t},o=t=>{let[l,e]=t;return l in i?i[l](e):void 0},a=t=>t.map(o),m=t=>typeof t!="object"||t===null?t:Object.fromEntries(Object.entries(t).map(([l,e])=>[l,o(e)]));class y extends HTMLElement{constructor(){super(...arguments);d(this,"Component");d(this,"hydrator");d(this,"hydrate",async()=>{var b;if(!this.hydrator||!this.isConnected)return;let e=(b=this.parentElement)==null?void 0:b.closest("astro-island[ssr]");if(e){e.addEventListener("astro:hydrate",this.hydrate,{once:!0});return}let c=this.querySelectorAll("astro-slot"),n={},h=this.querySelectorAll("template[data-astro-template]");for(let r of h){let s=r.closest(this.tagName);s!=null&&s.isSameNode(this)&&(n[r.getAttribute("data-astro-template")||"default"]=r.innerHTML,r.remove())}for(let r of c){let s=r.closest(this.tagName);s!=null&&s.isSameNode(this)&&(n[r.getAttribute("name")||"default"]=r.innerHTML)}let p;try{p=this.hasAttribute("props")?m(JSON.parse(this.getAttribute("props"))):{}}catch(r){let s=this.getAttribute("component-url")||"<unknown>",v=this.getAttribute("component-export");throw v&&(s+=` (export ${v})`),console.error(`[hydrate] Error parsing props for component ${s}`,this.getAttribute("props"),r),r}let u;await this.hydrator(this)(this.Component,p,n,{client:this.getAttribute("client")}),this.removeAttribute("ssr"),this.dispatchEvent(new CustomEvent("astro:hydrate"))});d(this,"unmount",()=>{this.isConnected||this.dispatchEvent(new CustomEvent("astro:unmount"))})}disconnectedCallback(){document.removeEventListener("astro:after-swap",this.unmount),document.addEventListener("astro:after-swap",this.unmount,{once:!0})}connectedCallback(){if(!this.hasAttribute("await-children")||document.readyState==="interactive"||document.readyState==="complete")this.childrenConnectedCallback();else{let e=()=>{document.removeEventListener("DOMContentLoaded",e),c.disconnect(),this.childrenConnectedCallback()},c=new MutationObserver(()=>{var n;((n=this.lastChild)==null?void 0:n.nodeType)===Node.COMMENT_NODE&&this.lastChild.nodeValue==="astro:end"&&(this.lastChild.remove(),e())});c.observe(this,{childList:!0}),document.addEventListener("DOMContentLoaded",e)}}async childrenConnectedCallback(){let e=this.getAttribute("before-hydration-url");e&&await import(e),this.start()}async start(){let e=JSON.parse(this.getAttribute("opts")),c=this.getAttribute("client");if(Astro[c]===void 0){window.addEventListener(`astro:${c}`,()=>this.start(),{once:!0});return}try{await Astro[c](async()=>{let n=this.getAttribute("renderer-url"),[h,{default:p}]=await Promise.all([import(this.getAttribute("component-url")),n?import(n):()=>()=>{}]),u=this.getAttribute("component-export")||"default";if(!u.includes("."))this.Component=h[u];else{this.Component=h;for(let f of u.split("."))this.Component=this.Component[f]}return this.hydrator=p,this.hydrate},e,this)}catch(n){console.error(`[astro-island] Error hydrating ${this.getAttribute("component-url")}`,n)}}attributeChangedCallback(){this.hydrate()}}d(y,"observedAttributes",["props"]),customElements.get("astro-island")||customElements.define("astro-island",y)}})();</script><astro-island uid="2gyiq8" prefix="r18" component-url="/blog-v3/_astro/mobile-menu.DMuQ8zgi.js" component-export="default" renderer-url="/blog-v3/_astro/client.B2EdmKkk.js" props="{&quot;data-astro-transition-persist&quot;:[0,&quot;astro-wpgf5xh5-2&quot;]}" ssr client="load" opts="{&quot;name&quot;:&quot;MobileMenu&quot;,&quot;value&quot;:true}" data-astro-transition-persist="astro-wpgf5xh5-2" await-children><button data-slot="dropdown-menu-trigger" class="inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 size-8 sm:hidden" title="Menu" type="button" id="radix-«r18R0»" aria-haspopup="menu" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-menu size-5" aria-hidden="true"><path d="M4 12h16"></path><path d="M4 18h16"></path><path d="M4 6h16"></path></svg><span class="sr-only">Toggle menu</span></button><!--astro:end--></astro-island> <button data-slot="button" class="inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 -me-2 size-8" id="theme-toggle" title="Toggle theme"> <svg width="1em" height="1em" class="size-4 scale-100 rotate-0 transition-all dark:scale-0 dark:-rotate-90" data-icon="lucide:sun">   <symbol id="ai:lucide:sun" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><circle cx="12" cy="12" r="4"/><path d="M12 2v2m0 16v2M4.93 4.93l1.41 1.41m11.32 11.32l1.41 1.41M2 12h2m16 0h2M6.34 17.66l-1.41 1.41M19.07 4.93l-1.41 1.41"/></g></symbol><use href="#ai:lucide:sun"></use>  </svg> <svg width="1em" height="1em" class="absolute size-4 scale-0 rotate-90 transition-all dark:scale-100 dark:rotate-0" data-icon="lucide:moon">   <symbol id="ai:lucide:moon" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3a6 6 0 0 0 9 9a9 9 0 1 1-9-9"/></symbol><use href="#ai:lucide:moon"></use>  </svg> <span class="sr-only">Toggle theme</span> </button> <script data-astro-rerun>
  const theme = (() => {
    const localStorageTheme = localStorage?.getItem('theme') ?? ''
    if (['dark', 'light'].includes(localStorageTheme)) {
      return localStorageTheme
    }
    if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
      return 'dark'
    }
    return 'light'
  })()

  document.documentElement.setAttribute('data-theme', theme)
  document.documentElement.classList.add(
    theme === 'dark' ? 'scheme-dark' : 'scheme-light',
  )
  window.localStorage.setItem('theme', theme)
</script> <script type="module">function a(){const e=document.documentElement,n=e.getAttribute("data-theme")==="dark"?"light":"dark";e.classList.add("[&_*]:transition-none"),e.setAttribute("data-theme",n),e.classList.remove("scheme-dark","scheme-light"),e.classList.add(n==="dark"?"scheme-dark":"scheme-light"),window.getComputedStyle(e).getPropertyValue("opacity"),requestAnimationFrame(()=>{e.classList.remove("[&_*]:transition-none")}),localStorage.setItem("theme",n)}function s(){const e=document.getElementById("theme-toggle");e&&e.addEventListener("click",a)}s();document.addEventListener("astro:after-swap",()=>{const e=localStorage.getItem("theme")||"light",t=document.documentElement;t.classList.add("[&_*]:transition-none"),window.getComputedStyle(t).getPropertyValue("opacity"),t.setAttribute("data-theme",e),t.classList.remove("scheme-dark","scheme-light"),t.classList.add(e==="dark"?"scheme-dark":"scheme-light"),requestAnimationFrame(()=>{t.classList.remove("[&_*]:transition-none")}),s()});</script> </div> </div> </header> <div id="mobile-subposts-container" class="w-full xl:hidden"><details class="group"><summary class="flex w-full cursor-pointer items-center justify-between"><div class="mx-auto flex w-full max-w-3xl items-center px-4 py-3"><div class="relative mr-2 size-4"><svg width="1em" height="1em" viewBox="0 0 24 24" class="size-4 flex-shrink-0" aria-hidden="true" data-icon="lucide:file-text">   <use href="#ai:lucide:file-text"></use>  </svg></div><div class="flex flex-grow flex-col truncate text-sm"><span class="text-muted-foreground truncate">Implementing sticky mobile navigation</span></div><span class="text-muted-foreground ml-2"><svg width="1em" height="1em" viewBox="0 0 24 24" class="h-4 w-4 transition-transform duration-200 group-open:rotate-180" data-icon="lucide:chevron-down">   <use href="#ai:lucide:chevron-down"></use>  </svg></span></div></summary><astro-island uid="Z1qqE7w" prefix="r29" component-url="/blog-v3/_astro/scroll-area.DMUDKI78.js" component-export="ScrollArea" renderer-url="/blog-v3/_astro/client.B2EdmKkk.js" props="{&quot;className&quot;:[0,&quot;mx-auto max-w-3xl&quot;],&quot;data-subposts-header-scroll&quot;:[0,true]}" ssr client="load" opts="{&quot;name&quot;:&quot;ScrollArea&quot;,&quot;value&quot;:true}" await-children><div dir="ltr" data-slot="scroll-area" class="relative mx-auto max-w-3xl" data-subposts-header-scroll="true" style="position:relative;--radix-scroll-area-corner-width:0px;--radix-scroll-area-corner-height:0px"><style>[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}</style><div data-radix-scroll-area-viewport="" data-slot="scroll-area-viewport" class="ring-ring/10 dark:ring-ring/20 dark:outline-ring/40 outline-ring/50 size-full rounded-[inherit] transition-[color,box-shadow] focus-visible:ring-4 focus-visible:outline-1" style="overflow-x:hidden;overflow-y:hidden"><div style="min-width:100%;display:table"><astro-slot><div class="max-h-[30vh]"><ul class="flex list-none flex-col gap-y-1 px-4 pb-4"><li><a href="/blog/mobile-nav-and-subposts" class="mobile-subposts-link hover:text-foreground text-muted-foreground hover:bg-muted/50 flex items-center gap-2 rounded-md px-2 py-1.5 text-sm transition-colors"><svg width="1em" height="1em" viewBox="0 0 24 24" class="size-4 flex-shrink-0" aria-hidden="true" data-icon="lucide:book-open">   <use href="#ai:lucide:book-open"></use>  </svg><div class="flex flex-col"><span class="line-clamp-2">v1.6.0: &quot;Mobile Navigation &amp; Subposts&quot;</span><span class="text-muted-foreground/80 hover:text-foreground/80 text-xs">4 min read<span> 
(11 min read total)
</span></span></div></a></li><div class="ml-4 space-y-1"><div class="text-foreground bg-muted mobile-subposts-active-item flex items-center gap-2 rounded-md px-2 py-1.5 text-sm font-medium"><svg width="1em" height="1em" viewBox="0 0 24 24" class="size-4 flex-shrink-0" aria-hidden="true" data-icon="lucide:file-text">   <use href="#ai:lucide:file-text"></use>  </svg><div class="flex flex-col"><span class="line-clamp-2">Implementing sticky mobile navigation</span><span class="text-muted-foreground/80 text-xs">5 min read</span></div></div><a href="/blog/mobile-nav-and-subposts/subposts" class="mobile-subposts-link hover:text-foreground text-muted-foreground hover:bg-muted/50 flex items-center gap-2 rounded-md px-2 py-1.5 text-sm transition-colors"><svg width="1em" height="1em" viewBox="0 0 24 24" class="size-4 flex-shrink-0" aria-hidden="true" data-icon="lucide:file">   <use href="#ai:lucide:file"></use>  </svg><div class="flex flex-col"><span class="line-clamp-2">Implementing file-based subpost routing</span><span class="text-muted-foreground/80 hover:text-foreground/80 text-xs">3 min read</span></div></a></div></ul></div></astro-slot></div></div></div><!--astro:end--></astro-island></details></div><script type="module">class m{scrollArea=null;detailsElement=null;headerScrollArea=null;reset(){this.scrollArea=null,this.detailsElement=null,this.headerScrollArea=null}}const e=new m;class i{static update(){if(!e.scrollArea||!e.headerScrollArea)return;const{scrollTop:t,scrollHeight:l,clientHeight:r}=e.scrollArea,s=5,a=t<=s,c=t>=l-r-s;e.headerScrollArea.classList.toggle("mask-t-from-80%",!a),e.headerScrollArea.classList.toggle("mask-b-from-80%",!c)}}class n{static toActive(){if(!e.scrollArea)return;const t=e.scrollArea.querySelector(".mobile-subposts-active-item");if(!t)return;const{top:l,height:r}=e.scrollArea.getBoundingClientRect(),{top:s,height:a}=t.getBoundingClientRect(),c=s-l+e.scrollArea.scrollTop,u=Math.max(0,Math.min(c-(r-a)/2,e.scrollArea.scrollHeight-e.scrollArea.clientHeight));e.scrollArea.scrollTop=u}static setupInteraction(){const t=document.getElementById("mobile-subposts-container");if(!t)return;e.scrollArea=t.querySelector("[data-radix-scroll-area-viewport]"),e.detailsElement=t.querySelector("details"),e.headerScrollArea=t.querySelector("[data-subposts-header-scroll]");const l=t.querySelectorAll(".mobile-subposts-link");e.scrollArea&&e.scrollArea.addEventListener("scroll",i.update,{passive:!0}),e.detailsElement&&e.detailsElement.addEventListener("toggle",()=>{e.detailsElement?.open&&requestAnimationFrame(()=>{n.toActive(),setTimeout(i.update,100)})}),l.forEach(r=>{r.addEventListener("click",()=>{e.detailsElement&&(e.detailsElement.open=!1)})})}}class o{static init(){e.reset(),n.setupInteraction()}static cleanup(){e.scrollArea&&e.scrollArea.removeEventListener("scroll",i.update),e.reset()}}document.addEventListener("astro:page-load",()=>o.init());document.addEventListener("astro:after-swap",()=>{o.cleanup(),o.init()});document.addEventListener("astro:before-swap",()=>o.cleanup());</script> <div id="mobile-toc-container" class="w-full xl:hidden"><details class="group"><summary class="flex w-full cursor-pointer items-center justify-between"><div class="mx-auto flex w-full max-w-3xl items-center px-4 py-3"><div class="relative mr-2 size-4"><svg class="h-4 w-4" viewBox="0 0 24 24"><circle class="text-primary/20" cx="12" cy="12" r="10" fill="none" stroke="currentColor" stroke-width="2"></circle><circle id="mobile-toc-progress-circle" class="text-primary" cx="12" cy="12" r="10" fill="none" stroke="currentColor" stroke-width="2" stroke-dasharray="62.83" stroke-dashoffset="62.83" transform="rotate(-90 12 12)"></circle></svg></div><span id="mobile-toc-current-section" class="text-muted-foreground flex-grow truncate text-sm">
Overview
</span><span class="text-muted-foreground ml-2"><svg width="1em" height="1em" viewBox="0 0 24 24" class="h-4 w-4 transition-transform duration-200 group-open:rotate-180" data-icon="lucide:chevron-down">   <use href="#ai:lucide:chevron-down"></use>  </svg></span></div></summary><astro-island uid="Z1rSLpz" prefix="r23" component-url="/blog-v3/_astro/scroll-area.DMUDKI78.js" component-export="ScrollArea" renderer-url="/blog-v3/_astro/client.B2EdmKkk.js" props="{&quot;className&quot;:[0,&quot;mx-auto max-w-3xl&quot;],&quot;data-toc-header-scroll&quot;:[0,true]}" ssr client="load" opts="{&quot;name&quot;:&quot;ScrollArea&quot;,&quot;value&quot;:true}" await-children><div dir="ltr" data-slot="scroll-area" class="relative mx-auto max-w-3xl" data-toc-header-scroll="true" style="position:relative;--radix-scroll-area-corner-width:0px;--radix-scroll-area-corner-height:0px"><style>[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}</style><div data-radix-scroll-area-viewport="" data-slot="scroll-area-viewport" class="ring-ring/10 dark:ring-ring/20 dark:outline-ring/40 outline-ring/50 size-full rounded-[inherit] transition-[color,box-shadow] focus-visible:ring-4 focus-visible:outline-1" style="overflow-x:hidden;overflow-y:hidden"><div style="min-width:100%;display:table"><astro-slot><div class="max-h-[30vh]"><ul class="flex list-none flex-col gap-y-2 px-4 pb-4" id="mobile-table-of-contents"><li class="px-4 text-sm text-foreground/60"><a href="#building-the-sticky-header-system" class="mobile-toc-item underline decoration-transparent underline-offset-[3px] transition-colors duration-200 hover:decoration-inherit" data-heading-id="building-the-sticky-header-system">Building the sticky header system</a></li><li class="px-4 text-sm ml-4 text-foreground/60"><a href="#live-scroll-highlighting-sucks" class="mobile-toc-item underline decoration-transparent underline-offset-[3px] transition-colors duration-200 hover:decoration-inherit" data-heading-id="live-scroll-highlighting-sucks">Live scroll highlighting sucks</a></li><li class="px-4 text-sm ml-4 text-foreground/60"><a href="#the-concept-of-jurisdictions" class="mobile-toc-item underline decoration-transparent underline-offset-[3px] transition-colors duration-200 hover:decoration-inherit" data-heading-id="the-concept-of-jurisdictions">The concept of “jurisdictions”</a></li><li class="px-4 text-sm ml-4 text-foreground/60"><a href="#the-decision-to-show-all-visible-sections" class="mobile-toc-item underline decoration-transparent underline-offset-[3px] transition-colors duration-200 hover:decoration-inherit" data-heading-id="the-decision-to-show-all-visible-sections">The decision to show all visible sections</a></li><li class="px-4 text-sm text-foreground/60"><a href="#progress-indicator-implementation" class="mobile-toc-item underline decoration-transparent underline-offset-[3px] transition-colors duration-200 hover:decoration-inherit" data-heading-id="progress-indicator-implementation">Progress indicator implementation</a></li></ul></div></astro-slot></div></div></div><!--astro:end--></astro-island></details></div><script type="module" src="/blog-v3/_astro/TOCHeader.astro_astro_type_script_index_0_lang.CKMLAwWj.js"></script> </div> <main class="grow"> <div class="mx-auto flex grow flex-col gap-y-6 px-4">   <section class="grid grid-cols-[minmax(0px,1fr)_min(calc(var(--breakpoint-md)-2rem),100%)_minmax(0px,1fr)] gap-y-6"> <div class="col-start-2"> <nav aria-label="breadcrumb" data-slot="breadcrumb"> <ol data-slot="breadcrumb-list" class="text-muted-foreground flex flex-wrap items-center gap-1.5 text-sm break-words sm:gap-2.5"> <li data-slot="breadcrumb-item" class="inline-flex items-center gap-1.5"> <a data-slot="breadcrumb-link" class="hover:text-foreground transition-colors" href="/"> <svg width="1em" height="1em" class="size-4 shrink-0" data-icon="lucide:home">   <symbol id="ai:lucide:home" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8"/><path d="M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/></g></symbol><use href="#ai:lucide:home"></use>  </svg> </a> </li>  <li data-slot="breadcrumb-separator" role="presentation" aria-hidden="true" class="[&amp;&gt;svg]:size-3.5"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-right" aria-hidden="true"><path d="m9 18 6-6-6-6"></path></svg></li> <li data-slot="breadcrumb-item" class="inline-flex items-center gap-1.5"><a data-slot="breadcrumb-link" class="hover:text-foreground transition-colors" href="/blog"> <span class="flex items-center gap-x-2"> <svg width="1em" height="1em" class="size-4 shrink-0" data-icon="lucide:library-big">   <symbol id="ai:lucide:library-big" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><rect width="8" height="18" x="3" y="3" rx="1"/><path d="M7 3v18m13.4-2.1c.2.5-.1 1.1-.6 1.3l-1.9.7c-.5.2-1.1-.1-1.3-.6L11.1 5.1c-.2-.5.1-1.1.6-1.3l1.9-.7c.5-.2 1.1.1 1.3.6Z"/></g></symbol><use href="#ai:lucide:library-big"></use>  </svg> <span>Blog</span> </span> </a></li>  <li data-slot="breadcrumb-separator" role="presentation" aria-hidden="true" class="[&amp;&gt;svg]:size-3.5"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-right" aria-hidden="true"><path d="m9 18 6-6-6-6"></path></svg></li> <li data-slot="breadcrumb-item" class="inline-flex items-center gap-1.5"><a data-slot="breadcrumb-link" class="hover:text-foreground transition-colors" href="/blog/mobile-nav-and-subposts"> <span class="flex items-center gap-x-2"> <svg width="1em" height="1em" viewBox="0 0 24 24" class="size-4 shrink-0" data-icon="lucide:book-open">   <use href="#ai:lucide:book-open"></use>  </svg> <span>v1.6.0: &quot;Mobile Navigation &amp; Subposts&quot;</span> </span> </a></li>  <li data-slot="breadcrumb-separator" role="presentation" aria-hidden="true" class="[&amp;&gt;svg]:size-3.5"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-right" aria-hidden="true"><path d="m9 18 6-6-6-6"></path></svg></li> <li data-slot="breadcrumb-item" class="inline-flex items-center gap-1.5"><span data-slot="breadcrumb-page" role="link" aria-disabled="true" aria-current="page" class="text-foreground font-normal"> <span class="flex items-center gap-x-2"> <svg width="1em" height="1em" viewBox="0 0 24 24" class="size-4 shrink-0" data-icon="lucide:file-text">   <use href="#ai:lucide:file-text"></use>  </svg> <span>Implementing sticky mobile navigation</span> </span> </span></li> </ol> </nav> </div>  <section class="col-start-2 flex flex-col gap-y-6 text-center"> <div class="flex flex-col"> <h1 class="mb-2 scroll-mt-31 text-3xl leading-tight font-medium sm:text-4xl" id="post-title"> Implementing sticky mobile navigation </h1> <div class="text-muted-foreground divide-border mb-4 flex flex-col items-center justify-center divide-y text-xs sm:flex-row sm:flex-wrap sm:divide-x sm:divide-y-0 sm:text-sm">  <div class="flex w-full items-center justify-center gap-2 py-2 sm:w-fit sm:px-2 sm:py-0 first:sm:pl-0 last:sm:pr-0"> <span>May 21, 2025</span> </div> <div class="flex w-full items-center justify-center gap-2 py-2 sm:w-fit sm:px-2 sm:py-0 first:sm:pl-0 last:sm:pr-0"> <span> 5 min read  </span> </div>  </div> <div class="flex flex-wrap justify-center gap-2"> <a href="/tags/v1.6.0" class="inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&#38;>svg]:size-3 gap-1 [&#38;>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden border-transparent bg-secondary text-secondary-foreground [a&#38;]:hover:bg-secondary/90"> <svg width="1em" height="1em" class="size-3" data-icon="lucide:hash">   <symbol id="ai:lucide:hash" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 9h16M4 15h16M10 3L8 21m8-18l-2 18"/></symbol><use href="#ai:lucide:hash"></use>  </svg> v1.6.0 </a> </div> </div> <nav class="col-start-2 grid grid-cols-1 gap-4 sm:grid-cols-3"> <a href="#" target="_self" class="duration-300 ease-in-out gap-2 whitespace-nowrap text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&#38;_svg]:pointer-events-none [&#38;_svg:not([class*='size-'])]:size-4 shrink-0 [&#38;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive border bg-background hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50 px-4 py-2 has-[>svg]:px-3 rounded-lg group flex items-center justify-start size-full pointer-events-none opacity-50 cursor-not-allowed" aria-disabled="true">  <svg width="1em" height="1em" class="mr-2 size-4 transition-transform group-hover:-translate-x-1" data-icon="lucide:arrow-left">   <symbol id="ai:lucide:arrow-left" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m12 19l-7-7l7-7m7 7H5"/></symbol><use href="#ai:lucide:arrow-left"></use>  </svg> <div class="flex flex-col items-start overflow-hidden text-wrap"> <span class="text-muted-foreground text-left text-xs"> Previous Subpost </span> <span class="w-full text-left text-sm text-balance text-ellipsis"> No older subpost </span> </div>  </a> <a href="/blog/mobile-nav-and-subposts#post-title" target="_self" class="duration-300 ease-in-out gap-2 whitespace-nowrap text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&#38;_svg]:pointer-events-none [&#38;_svg:not([class*='size-'])]:size-4 shrink-0 [&#38;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive border bg-background hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50 px-4 py-2 has-[>svg]:px-3 group flex size-full items-center justify-center rounded-lg">  <svg width="1em" height="1em" class="mr-2 size-4 transition-transform group-hover:-translate-y-1" data-icon="lucide:corner-left-up">   <symbol id="ai:lucide:corner-left-up" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M14 9L9 4L4 9"/><path d="M20 20h-7a4 4 0 0 1-4-4V4"/></g></symbol><use href="#ai:lucide:corner-left-up"></use>  </svg> <div class="flex flex-col items-center overflow-hidden text-wrap"> <span class="text-muted-foreground text-center text-xs">
Parent Post
</span> <span class="w-full text-center text-sm text-balance text-ellipsis"> v1.6.0: &quot;Mobile Navigation &amp; Subposts&quot; </span> </div>  </a> <a href="/blog/mobile-nav-and-subposts/subposts#post-title" target="_self" class="duration-300 ease-in-out gap-2 whitespace-nowrap text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&#38;_svg]:pointer-events-none [&#38;_svg:not([class*='size-'])]:size-4 shrink-0 [&#38;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive border bg-background hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50 px-4 py-2 has-[>svg]:px-3 rounded-lg group flex items-center justify-end size-full" aria-disabled="false">  <div class="flex flex-col items-end overflow-hidden text-wrap"> <span class="text-muted-foreground text-right text-xs"> Next Subpost </span> <span class="w-full text-right text-sm text-balance text-ellipsis"> Implementing file-based subpost routing </span> </div> <svg width="1em" height="1em" class="ml-2 size-4 transition-transform group-hover:translate-x-1" data-icon="lucide:arrow-right">   <symbol id="ai:lucide:arrow-right" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 12h14m-7-7l7 7l-7 7"/></symbol><use href="#ai:lucide:arrow-right"></use>  </svg>  </a> </nav> </section> <div id="toc-sidebar-container" class="sticky top-20 col-start-1 row-span-1 mr-8 ml-auto hidden h-[calc(100vh-5rem)] max-w-md xl:block"><astro-island uid="Z1xIdnD" prefix="r3" component-url="/blog-v3/_astro/scroll-area.DMUDKI78.js" component-export="ScrollArea" renderer-url="/blog-v3/_astro/client.B2EdmKkk.js" props="{&quot;className&quot;:[0,&quot;flex max-h-[calc(100vh-8rem)] flex-col overflow-y-auto&quot;],&quot;type&quot;:[0,&quot;hover&quot;],&quot;data-toc-scroll-area&quot;:[0,true]}" ssr client="load" opts="{&quot;name&quot;:&quot;ScrollArea&quot;,&quot;value&quot;:true}" await-children><div dir="ltr" data-slot="scroll-area" class="relative flex max-h-[calc(100vh-8rem)] flex-col overflow-y-auto" data-toc-scroll-area="true" style="position:relative;--radix-scroll-area-corner-width:0px;--radix-scroll-area-corner-height:0px"><style>[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}</style><div data-radix-scroll-area-viewport="" data-slot="scroll-area-viewport" class="ring-ring/10 dark:ring-ring/20 dark:outline-ring/40 outline-ring/50 size-full rounded-[inherit] transition-[color,box-shadow] focus-visible:ring-4 focus-visible:outline-1" style="overflow-x:hidden;overflow-y:hidden"><div style="min-width:100%;display:table"><astro-slot><div class="flex flex-col gap-2 px-4"><span class="text-lg font-medium">Table of Contents</span><ul class="flex list-none flex-col gap-y-2"><li class="text-sm text-foreground/40"><a href="/blog/mobile-nav-and-subposts#two-major-improvements-to-the-reading-experience" class="marker:text-foreground/30 list-none underline decoration-transparent underline-offset-[3px] transition-colors duration-200 hover:decoration-inherit" data-heading-link="two-major-improvements-to-the-reading-experience">Two major improvements to the reading experience</a></li><li class="text-sm ml-4 text-foreground/40"><a href="/blog/mobile-nav-and-subposts#mobile-navigation" class="marker:text-foreground/30 list-none underline decoration-transparent underline-offset-[3px] transition-colors duration-200 hover:decoration-inherit" data-heading-link="mobile-navigation">Mobile navigation</a></li><li class="text-sm ml-4 text-foreground/40"><a href="/blog/mobile-nav-and-subposts#subposts-for-hierarchical-content-organization" class="marker:text-foreground/30 list-none underline decoration-transparent underline-offset-[3px] transition-colors duration-200 hover:decoration-inherit" data-heading-link="subposts-for-hierarchical-content-organization">Subposts for hierarchical content organization</a></li><li class="text-sm ml-8 text-foreground/40"><a href="/blog/mobile-nav-and-subposts#enhanced-navigation-patterns" class="marker:text-foreground/30 list-none underline decoration-transparent underline-offset-[3px] transition-colors duration-200 hover:decoration-inherit" data-heading-link="enhanced-navigation-patterns">Enhanced navigation patterns</a></li><li class="text-sm ml-8 text-foreground/40"><a href="/blog/mobile-nav-and-subposts#hint-this-is-great-for-technical-content" class="marker:text-foreground/30 list-none underline decoration-transparent underline-offset-[3px] transition-colors duration-200 hover:decoration-inherit" data-heading-link="hint-this-is-great-for-technical-content">Hint: this is great for technical content</a></li><li class="text-sm text-foreground/40"><a href="/blog/mobile-nav-and-subposts#go-ahead-and-read-the-subposts" class="marker:text-foreground/30 list-none underline decoration-transparent underline-offset-[3px] transition-colors duration-200 hover:decoration-inherit" data-heading-link="go-ahead-and-read-the-subposts">Go ahead and read the subposts</a></li></ul><div class="mt-2 flex items-center gap-2"><div class="bg-border h-px flex-1"></div><span class="text-muted-foreground text-xs font-medium">
Subposts
</span><div class="bg-border h-px flex-1"></div></div><div class="border p-2 bg-muted/50"><ul class="flex list-none flex-col gap-y-2"><li class="text-xs font-medium text-foreground"><a href="#" class="marker:text-foreground/30 list-none underline decoration-transparent underline-offset-[3px] transition-colors duration-200 hover:decoration-inherit" data-heading-link="top">Implementing sticky mobile navigation</a></li><li class="text-xs text-foreground/60"><a href="#building-the-sticky-header-system" class="marker:text-foreground/30 hover:text-foreground/60 list-none underline decoration-transparent underline-offset-[3px] transition-colors duration-200 hover:decoration-inherit" data-heading-link="building-the-sticky-header-system">Building the sticky header system</a></li><li class="text-xs ml-4 text-foreground/60"><a href="#live-scroll-highlighting-sucks" class="marker:text-foreground/30 hover:text-foreground/60 list-none underline decoration-transparent underline-offset-[3px] transition-colors duration-200 hover:decoration-inherit" data-heading-link="live-scroll-highlighting-sucks">Live scroll highlighting sucks</a></li><li class="text-xs ml-4 text-foreground/60"><a href="#the-concept-of-jurisdictions" class="marker:text-foreground/30 hover:text-foreground/60 list-none underline decoration-transparent underline-offset-[3px] transition-colors duration-200 hover:decoration-inherit" data-heading-link="the-concept-of-jurisdictions">The concept of “jurisdictions”</a></li><li class="text-xs ml-4 text-foreground/60"><a href="#the-decision-to-show-all-visible-sections" class="marker:text-foreground/30 hover:text-foreground/60 list-none underline decoration-transparent underline-offset-[3px] transition-colors duration-200 hover:decoration-inherit" data-heading-link="the-decision-to-show-all-visible-sections">The decision to show all visible sections</a></li><li class="text-xs text-foreground/60"><a href="#progress-indicator-implementation" class="marker:text-foreground/30 hover:text-foreground/60 list-none underline decoration-transparent underline-offset-[3px] transition-colors duration-200 hover:decoration-inherit" data-heading-link="progress-indicator-implementation">Progress indicator implementation</a></li></ul></div><div class="border p-2"><ul class="flex list-none flex-col gap-y-2"><li class="text-xs font-medium text-foreground/60"><a href="/blog/mobile-nav-and-subposts/subposts" class="marker:text-foreground/30 list-none underline decoration-transparent underline-offset-[3px] transition-colors duration-200 hover:decoration-inherit" data-heading-link="mobile-nav-and-subposts/subposts-top">Implementing file-based subpost routing</a></li><li class="text-xs text-foreground/30"><a href="/blog/mobile-nav-and-subposts/subposts#navigation-complexity" class="marker:text-foreground/30 hover:text-foreground/60 list-none underline decoration-transparent underline-offset-[3px] transition-colors duration-200 hover:decoration-inherit" data-heading-link="mobile-nav-and-subposts/subposts-navigation-complexity">Navigation complexity</a></li><li class="text-xs text-foreground/30"><a href="/blog/mobile-nav-and-subposts/subposts#other-considerations" class="marker:text-foreground/30 hover:text-foreground/60 list-none underline decoration-transparent underline-offset-[3px] transition-colors duration-200 hover:decoration-inherit" data-heading-link="mobile-nav-and-subposts/subposts-other-considerations">Other considerations</a></li></ul></div></div></astro-slot></div></div></div><!--astro:end--></astro-island></div><script type="module">class f{links=document.querySelectorAll("[data-heading-link]");activeIds=[];headings=[];regions=[];scrollArea=null;tocScrollArea=null;reset(){this.links=document.querySelectorAll("#toc-sidebar-container [data-heading-link]"),this.activeIds=[],this.headings=[],this.regions=[];const t=document.getElementById("toc-sidebar-container");this.scrollArea=t?.querySelector("[data-radix-scroll-area-viewport]")||null,this.tocScrollArea=t?.querySelector("[data-toc-scroll-area]")||null}}const e=new f;class c{static build(){if(e.headings=Array.from(document.querySelectorAll(".prose h2, .prose h3, .prose h4, .prose h5, .prose h6")),e.headings.length===0){e.regions=[];return}e.regions=e.headings.map((t,o)=>{const i=e.headings[o+1];return{id:t.id,start:t.offsetTop,end:i?i.offsetTop:document.body.scrollHeight}})}static getVisibleIds(){if(e.headings.length===0)return[];const t=window.scrollY+80,o=window.scrollY+window.innerHeight,i=new Set,l=(s,r)=>s>=t&&s<=o||r>=t&&r<=o||s<=t&&r>=o;return e.headings.forEach(s=>{const r=s.offsetTop+s.offsetHeight;l(s.offsetTop,r)&&i.add(s.id)}),e.regions.forEach(s=>{if(s.start<=o&&s.end>=t){const r=document.getElementById(s.id);if(r){const a=r.offsetTop+r.offsetHeight;s.end>a&&(a<o||t<s.end)&&i.add(s.id)}}}),Array.from(i)}}class h{static update(){if(!e.scrollArea||!e.tocScrollArea)return;const{scrollTop:t,scrollHeight:o,clientHeight:i}=e.scrollArea,l=5,s=t<=l,r=t>=o-i-l;e.tocScrollArea.classList.toggle("mask-t-from-90%",!s),e.tocScrollArea.classList.toggle("mask-b-from-90%",!r)}}class g{static update(t){e.links.forEach(o=>{o.classList.remove("text-foreground")}),t.forEach(o=>{if(o){const i=document.querySelector(`#toc-sidebar-container [data-heading-link="${o}"]`);i&&i.classList.add("text-foreground")}}),this.scrollToActive(t)}static scrollToActive(t){if(!e.scrollArea||!t.length)return;const o=document.querySelector(`#toc-sidebar-container [data-heading-link="${t[0]}"]`);if(!o)return;const{top:i,height:l}=e.scrollArea.getBoundingClientRect(),{top:s,height:r}=o.getBoundingClientRect(),a=s-i+e.scrollArea.scrollTop,u=Math.max(0,Math.min(a-(l-r)/2,e.scrollArea.scrollHeight-e.scrollArea.clientHeight));Math.abs(u-e.scrollArea.scrollTop)>5&&(e.scrollArea.scrollTop=u)}}class d{static handleScroll(){const t=c.getVisibleIds();JSON.stringify(t)!==JSON.stringify(e.activeIds)&&(e.activeIds=t,g.update(e.activeIds))}static handleTOCScroll=()=>h.update();static handleResize(){c.build();const t=c.getVisibleIds();JSON.stringify(t)!==JSON.stringify(e.activeIds)&&(e.activeIds=t,g.update(e.activeIds)),h.update()}static init(){if(e.reset(),c.build(),e.headings.length===0){g.update([]);return}this.handleScroll(),setTimeout(h.update,100);const t={passive:!0};window.addEventListener("scroll",this.handleScroll,t),window.addEventListener("resize",this.handleResize,t),e.scrollArea?.addEventListener("scroll",this.handleTOCScroll,t)}static cleanup(){window.removeEventListener("scroll",this.handleScroll),window.removeEventListener("resize",this.handleResize),e.scrollArea?.removeEventListener("scroll",this.handleTOCScroll),Object.assign(e,{activeIds:[],headings:[],regions:[],scrollArea:null,tocScrollArea:null})}}document.addEventListener("astro:page-load",()=>d.init());document.addEventListener("astro:after-swap",()=>{d.cleanup(),d.init()});document.addEventListener("astro:before-swap",()=>d.cleanup());</script> <article class="prose col-start-2 max-w-none"> <p>The original mobile table of contents was a simple collapsible element that lived within the post content. This created several usability issues:</p>
<ol>
<li>Users had no sense of how much content remained other than implying it based on the length of the browser scrollbar</li>
<li>Once you scrolled past the TOC, you lose the ability to quickly navigate to other sections of the post without scrolling back up to the inline TOC</li>
<li>Mobile users should have the exact same experience as desktop users in terms of navigation, and as of now the desktop experience was better (due to the sticky aside TOC)</li>
</ol>
<h2 id="building-the-sticky-header-system">Building the sticky header system</h2>
<p>Design-wise, the component is relatively simple, since it only includes a chevron to indicate expansion state, a circular progress indicator that fills as you scroll, and a dynamic text showing the current section (or a combination of sections, if multiple are visible at the same time).</p>
<h3 id="live-scroll-highlighting-sucks">Live scroll highlighting sucks</h3>
<p>One of the more interesting problems I encountered was how to handle the highlighting of sections as you scroll. Of course, this applies to both mobile and desktop versions, but in this update I changed the implementation of both.</p>
<p>A naive implementation of live scroll highlighting would simply use an <code>IntersectionObserver(){:js}</code> to watch for headers entering and exiting the viewport. The issue with this is that it doesn’t highlight anything if headers are no longer visible in your viewport, regardless of whether you’re in a section that “belongs” to a heading.</p>
<details class="relative px-4 py-3 my-6 border-l-4 text-sm border-emerald-500 dark:bg-emerald-950/5 [&#38;[open]>summary_svg:last-child]:rotate-180 [&#38;[open]>summary]:mb-3" open> <summary class="flex cursor-pointer items-center font-medium [&::-webkit-details-marker]:hidden"> <svg width="1em" height="1em" class="mr-2 size-4 shrink-0 text-emerald-700 dark:text-emerald-300" data-icon="lucide:code">   <symbol id="ai:lucide:code" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m16 18l6-6l-6-6M8 6l-6 6l6 6"/></symbol><use href="#ai:lucide:code"></use>  </svg> <span class="font-medium mr-2 text-emerald-700 dark:text-emerald-300"> Example  </span> <svg width="1em" height="1em" class="ml-auto h-4 w-4 shrink-0 transition-transform duration-200 text-emerald-700 dark:text-emerald-300" data-icon="lucide:chevron-down">   <symbol id="ai:lucide:chevron-down" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m6 9l6 6l6-6"/></symbol><use href="#ai:lucide:chevron-down"></use>  </svg> </summary> <div> <p>Say that we have a post with the following structure:</p><div class="expressive-code"><link rel="stylesheet" href="/blog-v3/_astro/ec.e4ggb.css"/><script type="module" src="/blog-v3/_astro/ec.8zarh.js"></script><figure class="frame"><figcaption class="header"></figcaption><pre data-language="markdown" class="wrap" style="--ecMaxLine:22ch"><code><div class="ec-line"><div class="code"><span style="--0:#005CC5;--0fw:bold;--1:#79B8FF;--1fw:bold">## Part 1</span></div></div><div class="ec-line"><div class="code"><span style="--0:#24292E;--1:#E1E4E8">[500 lines of content]</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#005CC5;--0fw:bold;--1:#79B8FF;--1fw:bold">## Part 2</span></div></div><div class="ec-line"><div class="code"><span style="--0:#24292E;--1:#E1E4E8">[500 lines of content]</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="## Part 1[500 lines of content]## Part 2[500 lines of content]"><div></div></button></div></figure></div><p>If you were to scroll way past the first heading and was deep into the first section underneath it, the naive implementation would not highlight the first heading because it’s no longer in your viewport. This is unintuitive and a poor user experience. In a perfect world, if we were to view 250 lines of Part 1 and 250 lines of Part 2, then we would see both headings highlighted in the TOC and not need to make a decision about which heading to highlight.</p> </div> </details>
<p>I used to rely on <a href="https://github.com/jake-low/remark-sectionize" rel="nofollow noreferrer noopener" target="_blank">jakelow/remark-sectionize</a>, a <a href="https://github.com/remarkjs/remark" rel="nofollow noreferrer noopener" target="_blank">remarkjs/remark</a> plugin that retroactively generates <code>&lt;section&gt;{:html}</code> tags based on the headers in the generated HTML. This would have done the following conversion:</p>
<div class="grid grid-cols-1 sm:grid-cols-2 gap-4 [&#38;_img,p,.expressive-code]:m-0"><div><div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="markdown" class="wrap" style="--ecMaxLine:62ch"><code><div class="ec-line"><div class="code"><span style="--0:#005CC5;--0fw:bold;--1:#79B8FF;--1fw:bold"># Forest elephants</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#005CC5;--0fw:bold;--1:#79B8FF;--1fw:bold">## Introduction</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#24292E;--1:#E1E4E8">In this section, we discuss the lesser known forest elephants.</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#005CC5;--0fw:bold;--1:#79B8FF;--1fw:bold">## Habitat</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#24292E;--1:#E1E4E8">Forest elephants do not live in trees but among them.</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="# Forest elephants## IntroductionIn this section, we discuss the lesser known forest elephants.## HabitatForest elephants do not live in trees but among them."><div></div></button></div></figure></div></div><div><div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="html" class="wrap" style="--ecMaxLine:73ch"><code><div class="ec-line"><div class="code"><span style="--0:#24292E;--1:#E1E4E8">&lt;</span><span style="--0:#1E7734;--1:#85E89D">section</span><span style="--0:#24292E;--1:#E1E4E8">&gt;</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">  </span></span><span style="--0:#24292E;--1:#E1E4E8">&lt;</span><span style="--0:#1E7734;--1:#85E89D">h1</span><span style="--0:#24292E;--1:#E1E4E8">&gt;Forest elephants&lt;/</span><span style="--0:#1E7734;--1:#85E89D">h1</span><span style="--0:#24292E;--1:#E1E4E8">&gt;</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">  </span></span><span style="--0:#24292E;--1:#E1E4E8">&lt;</span><span style="--0:#1E7734;--1:#85E89D">section</span><span style="--0:#24292E;--1:#E1E4E8">&gt;</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">    </span></span><span style="--0:#24292E;--1:#E1E4E8">&lt;</span><span style="--0:#1E7734;--1:#85E89D">h2</span><span style="--0:#24292E;--1:#E1E4E8">&gt;Introduction&lt;/</span><span style="--0:#1E7734;--1:#85E89D">h2</span><span style="--0:#24292E;--1:#E1E4E8">&gt;</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">    </span></span><span style="--0:#24292E;--1:#E1E4E8">&lt;</span><span style="--0:#1E7734;--1:#85E89D">p</span><span style="--0:#24292E;--1:#E1E4E8">&gt;In this section, we discuss the lesser known forest elephants.&lt;/</span><span style="--0:#1E7734;--1:#85E89D">p</span><span style="--0:#24292E;--1:#E1E4E8">&gt;</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">  </span></span><span style="--0:#24292E;--1:#E1E4E8">&lt;/</span><span style="--0:#1E7734;--1:#85E89D">section</span><span style="--0:#24292E;--1:#E1E4E8">&gt;</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">  </span></span><span style="--0:#24292E;--1:#E1E4E8">&lt;</span><span style="--0:#1E7734;--1:#85E89D">section</span><span style="--0:#24292E;--1:#E1E4E8">&gt;</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">    </span></span><span style="--0:#24292E;--1:#E1E4E8">&lt;</span><span style="--0:#1E7734;--1:#85E89D">h2</span><span style="--0:#24292E;--1:#E1E4E8">&gt;Habitat&lt;/</span><span style="--0:#1E7734;--1:#85E89D">h2</span><span style="--0:#24292E;--1:#E1E4E8">&gt;</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">    </span></span><span style="--0:#24292E;--1:#E1E4E8">&lt;</span><span style="--0:#1E7734;--1:#85E89D">p</span><span style="--0:#24292E;--1:#E1E4E8">&gt;Forest elephants do not live in trees but among them.&lt;/</span><span style="--0:#1E7734;--1:#85E89D">p</span><span style="--0:#24292E;--1:#E1E4E8">&gt;</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">  </span></span><span style="--0:#24292E;--1:#E1E4E8">&lt;/</span><span style="--0:#1E7734;--1:#85E89D">section</span><span style="--0:#24292E;--1:#E1E4E8">&gt;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#24292E;--1:#E1E4E8">&lt;/</span><span style="--0:#1E7734;--1:#85E89D">section</span><span style="--0:#24292E;--1:#E1E4E8">&gt;</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="<section>  <h1>Forest elephants</h1>  <section>    <h2>Introduction</h2>    <p>In this section, we discuss the lesser known forest elephants.</p>  </section>  <section>    <h2>Habitat</h2>    <p>Forest elephants do not live in trees but among them.</p>  </section></section>"><div></div></button></div></figure></div></div></div>
<p>However, this approach had pretty complicated issues involving section nesting and the fact that we didn’t have any control over its output other than by patching it. So, I decided to opt for a home-grown solution.</p>
<h3 id="the-concept-of-jurisdictions">The concept of “jurisdictions”</h3>
<p>The naming is interesting but I felt like it was the most intuitive to me. Basically, I created a system that assigns each heading a “territory” that extends from its position to the start of the next heading (or the end of the document):</p>
<div class="expressive-code"><figure class="frame has-title" style="--lnWidth:3ch"><figcaption class="header"><span class="title">src/components/TOCHeader.astro</span></figcaption><pre data-language="javascript" class="wrap" style="--ecMaxLine:86ch"><code><div class="ec-line"><div class="code"><span style="--0:#BF3441;--1:#F97583">function</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#6F42C1;--1:#B392F0">buildHeadingJurisdictions</span><span style="--0:#24292E;--1:#E1E4E8">() {</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">  </span></span><span style="--0:#24292E;--1:#E1E4E8">headingElements </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> Array.</span><span style="--0:#6F42C1;--1:#B392F0">from</span><span style="--0:#24292E;--1:#E1E4E8">(</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">    </span></span><span style="--0:#24292E;--1:#E1E4E8">document.</span><span style="--0:#6F42C1;--1:#B392F0">querySelectorAll</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#032F62;--1:#9ECBFF">&#39;.prose h2, .prose h3, .prose h4, .prose h5, .prose h6&#39;</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">  </span></span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line" style="--ecIndent:2ch"><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">  </span></span><span style="--0:#24292E;--1:#E1E4E8">jurisdictions </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> headingElements.</span><span style="--0:#6F42C1;--1:#B392F0">map</span><span style="--0:#24292E;--1:#E1E4E8">((</span><span style="--0:#AE4B07;--1:#FFAB70">heading</span><span style="--0:#24292E;--1:#E1E4E8">, </span><span style="--0:#AE4B07;--1:#FFAB70">index</span><span style="--0:#24292E;--1:#E1E4E8">) </span><span style="--0:#BF3441;--1:#F97583">=&gt;</span><span style="--0:#24292E;--1:#E1E4E8"> {</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="code"><span class="indent">    </span><span style="--0:#BF3441;--1:#F97583">const</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">nextHeading</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> headingElements[index </span><span style="--0:#BF3441;--1:#F97583">+</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">1</span><span style="--0:#24292E;--1:#E1E4E8">]</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="code"><span class="indent">    </span><span style="--0:#BF3441;--1:#F97583">return</span><span style="--0:#24292E;--1:#E1E4E8"> {</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">      </span></span><span style="--0:#24292E;--1:#E1E4E8">id: heading.id,</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">      </span></span><span style="--0:#24292E;--1:#E1E4E8">start: heading.offsetTop,</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">      </span></span><span style="--0:#24292E;--1:#E1E4E8">end: nextHeading </span><span style="--0:#BF3441;--1:#F97583">?</span><span style="--0:#24292E;--1:#E1E4E8"> nextHeading.offsetTop </span><span style="--0:#BF3441;--1:#F97583">:</span><span style="--0:#24292E;--1:#E1E4E8"> document.body.scrollHeight</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">    </span></span><span style="--0:#24292E;--1:#E1E4E8">}</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">  </span></span><span style="--0:#24292E;--1:#E1E4E8">})</span></div></div><div class="ec-line"><div class="code"><span style="--0:#24292E;--1:#E1E4E8">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="function buildHeadingJurisdictions() {  headingElements = Array.from(    document.querySelectorAll('.prose h2, .prose h3, .prose h4, .prose h5, .prose h6')  )  jurisdictions = headingElements.map((heading, index) => {    const nextHeading = headingElements[index + 1]    return {      id: heading.id,      start: heading.offsetTop,      end: nextHeading ? nextHeading.offsetTop : document.body.scrollHeight    }  })}"><div></div></button></div></figure></div>
<ol>
<li>First, we collect all heading elements (<code>&lt;h2&gt;{:html}</code> through <code>&lt;h6&gt;{:html}</code>) from the document’s prose content area using <code>.querySelectorAll(){:js}</code>.</li>
<li>For each heading, we create a jurisdiction object that contains the heading’s <code>id</code>, the vertical position where this section begins (the heading’s <code>offsetTop</code> value, which we name <code>start</code>), and the vertical position where this section ends (the <code>offsetTop</code> of the next heading or the bottom of the document if it’s the last heading, which we name <code>end</code>).</li>
</ol>
<p>This creates a map of “territories” that each heading controls. This is crucial for accurately tracking which jurisdictions are currently visible as the user scrolls, even when the actual heading element itself is no longer in view.</p>
<h3 id="the-decision-to-show-all-visible-sections">The decision to show all visible sections</h3>
<p>One of the more interesting decisions I made was to display all sections as comma-separated within the mobile TOC’s unexpanded state. This manifests as follows:</p>
<details class="relative px-4 py-3 my-6 border-l-4 text-sm border-emerald-500 dark:bg-emerald-950/5 [&#38;[open]>summary_svg:last-child]:rotate-180 [&#38;[open]>summary]:mb-3" open> <summary class="flex cursor-pointer items-center font-medium [&::-webkit-details-marker]:hidden"> <svg width="1em" height="1em" viewBox="0 0 24 24" class="mr-2 size-4 shrink-0 text-emerald-700 dark:text-emerald-300" data-icon="lucide:code">   <use href="#ai:lucide:code"></use>  </svg> <span class="font-medium mr-2 text-emerald-700 dark:text-emerald-300"> Example  </span> <svg width="1em" height="1em" viewBox="0 0 24 24" class="ml-auto h-4 w-4 shrink-0 transition-transform duration-200 text-emerald-700 dark:text-emerald-300" data-icon="lucide:chevron-down">   <use href="#ai:lucide:chevron-down"></use>  </svg> </summary> <div> <p>Recall the previous example’s scenario:</p><div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="markdown" class="wrap" style="--ecMaxLine:22ch"><code><div class="ec-line"><div class="code"><span style="--0:#005CC5;--0fw:bold;--1:#79B8FF;--1fw:bold">## Part 1</span></div></div><div class="ec-line"><div class="code"><span style="--0:#24292E;--1:#E1E4E8">[500 lines of content]</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#005CC5;--0fw:bold;--1:#79B8FF;--1fw:bold">## Part 2</span></div></div><div class="ec-line"><div class="code"><span style="--0:#24292E;--1:#E1E4E8">[500 lines of content]</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="## Part 1[500 lines of content]## Part 2[500 lines of content]"><div></div></button></div></figure></div><p>If we saw 250 lines of Part 1 and 250 lines of Part 2, then the text snippet in the mobile TOC would read “Part 1, Part 2”.</p> </div> </details>
<p>The temptation is to implement a “smart” selection algorithm, perhaps showing the section with the most visible content, or the one closest to the viewport center, or to show the “deepest,” most specifically nested section. However, this creates numerous edge cases:</p>
<ol>
<li>
<p>If you click to navigate to a short final section, it might never become the “primary” section because there isn’t enough content below it to scroll it to the top of the viewport.</p>
</li>
<li>
<p>As you scroll between sections, a “smart” selector might switch which section it considers primary at seemingly arbitrary points, creating a jarring experience.</p>
</li>
<li>
<p>When your viewport shows roughly equal amounts of two sections, any selection algorithm becomes essentially arbitrary.</p>
</li>
</ol>
<p>By showing all visible sections, we give users complete awareness of their position in the document, eliminate the edge cases mentioned above, and create predictable behavior.</p>
<h2 id="progress-indicator-implementation">Progress indicator implementation</h2>
<p>The circular progress indicator provides immediate visual feedback about reading progress without requiring any interaction:</p>
<div class="expressive-code"><figure class="frame has-title" style="--lnWidth:3ch"><figcaption class="header"><span class="title">src/components/TOCHeader.astro</span></figcaption><pre data-language="javascript" class="wrap" style="--ecMaxLine:71ch"><code><div class="ec-line" style="--ecIndent:2ch"><div class="code"><span class="indent">  </span><span style="--0:#BF3441;--1:#F97583">function</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#6F42C1;--1:#B392F0">updateProgressCircle</span><span style="--0:#24292E;--1:#E1E4E8">() {</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="code"><span class="indent">    </span><span style="--0:#BF3441;--1:#F97583">if</span><span style="--0:#24292E;--1:#E1E4E8"> (</span><span style="--0:#BF3441;--1:#F97583">!</span><span style="--0:#24292E;--1:#E1E4E8">progressCircleElement) </span><span style="--0:#BF3441;--1:#F97583">return</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="code"><span class="indent">    </span><span style="--0:#BF3441;--1:#F97583">const</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">scrollableDistance</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">=</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">      </span></span><span style="--0:#24292E;--1:#E1E4E8">document.documentElement.scrollHeight </span><span style="--0:#BF3441;--1:#F97583">-</span><span style="--0:#24292E;--1:#E1E4E8"> window.innerHeight</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="code"><span class="indent">    </span><span style="--0:#BF3441;--1:#F97583">const</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">scrollProgress</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">=</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">      </span></span><span style="--0:#24292E;--1:#E1E4E8">scrollableDistance </span><span style="--0:#BF3441;--1:#F97583">&gt;</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">0</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="code"><span class="indent">        </span><span style="--0:#BF3441;--1:#F97583">?</span><span style="--0:#24292E;--1:#E1E4E8"> Math.</span><span style="--0:#6F42C1;--1:#B392F0">min</span><span style="--0:#24292E;--1:#E1E4E8">(Math.</span><span style="--0:#6F42C1;--1:#B392F0">max</span><span style="--0:#24292E;--1:#E1E4E8">(window.scrollY </span><span style="--0:#BF3441;--1:#F97583">/</span><span style="--0:#24292E;--1:#E1E4E8"> scrollableDistance, </span><span style="--0:#005CC5;--1:#79B8FF">0</span><span style="--0:#24292E;--1:#E1E4E8">), </span><span style="--0:#005CC5;--1:#79B8FF">1</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="code"><span class="indent">        </span><span style="--0:#BF3441;--1:#F97583">:</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">0</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">    </span></span><span style="--0:#24292E;--1:#E1E4E8">progressCircleElement.style.</span><span style="--0:#6F42C1;--1:#B392F0">strokeDashoffset</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> (</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="code"><span class="indent">      </span><span style="--0:#005CC5;--1:#79B8FF">PROGRESS_CIRCLE_CIRCUMFERENCE</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">*</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">      </span></span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#005CC5;--1:#79B8FF">1</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">-</span><span style="--0:#24292E;--1:#E1E4E8"> scrollProgress)</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">    </span></span><span style="--0:#24292E;--1:#E1E4E8">).</span><span style="--0:#6F42C1;--1:#B392F0">toString</span><span style="--0:#24292E;--1:#E1E4E8">()</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">  </span></span><span style="--0:#24292E;--1:#E1E4E8">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="  function updateProgressCircle() {    if (!progressCircleElement) return    const scrollableDistance =      document.documentElement.scrollHeight - window.innerHeight    const scrollProgress =      scrollableDistance > 0        ? Math.min(Math.max(window.scrollY / scrollableDistance, 0), 1)        : 0    progressCircleElement.style.strokeDashoffset = (      PROGRESS_CIRCLE_CIRCUMFERENCE *      (1 - scrollProgress)    ).toString()  }"><div></div></button></div></figure></div>
<p>The progress is calculated as a ratio of current scroll position to total scrollable distance, then applied as a stroke-dashoffset to create the filling effect.</p> </article> <div id="subposts-sidebar-container" class="sticky top-20 col-start-3 row-span-1 mr-auto ml-8 hidden h-[calc(100vh-5rem)] max-w-md xl:block"> <astro-island uid="Z1CcDu" prefix="r5" component-url="/blog-v3/_astro/scroll-area.DMUDKI78.js" component-export="ScrollArea" renderer-url="/blog-v3/_astro/client.B2EdmKkk.js" props="{&quot;className&quot;:[0,&quot;flex max-h-[calc(100vh-8rem)] flex-col overflow-y-auto&quot;],&quot;data-subposts-sidebar-scroll&quot;:[0,true]}" ssr client="load" opts="{&quot;name&quot;:&quot;ScrollArea&quot;,&quot;value&quot;:true}" await-children><div dir="ltr" data-slot="scroll-area" class="relative flex max-h-[calc(100vh-8rem)] flex-col overflow-y-auto" data-subposts-sidebar-scroll="true" style="position:relative;--radix-scroll-area-corner-width:0px;--radix-scroll-area-corner-height:0px"><style>[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}</style><div data-radix-scroll-area-viewport="" data-slot="scroll-area-viewport" class="ring-ring/10 dark:ring-ring/20 dark:outline-ring/40 outline-ring/50 size-full rounded-[inherit] transition-[color,box-shadow] focus-visible:ring-4 focus-visible:outline-1" style="overflow-x:hidden;overflow-y:hidden"><div style="min-width:100%;display:table"><astro-slot> <div class="px-4"> <ul class="space-y-1"> <li> <a href="/blog/mobile-nav-and-subposts#post-title" target="_self" class="duration-300 ease-in-out hover:text-foreground text-muted-foreground hover:bg-muted/50 subposts-sidebar-link flex items-center gap-2 rounded-md px-2 py-1.5 text-sm text-pretty transition-colors">  <svg width="1em" height="1em" class="size-4 flex-shrink-0" aria-hidden="true" data-icon="lucide:book-open">   <symbol id="ai:lucide:book-open" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 7v14m-9-3a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4a4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3a3 3 0 0 0-3-3z"/></symbol><use href="#ai:lucide:book-open"></use>  </svg> <div class="flex flex-col"> <span class="line-clamp-2 text-pretty"> v1.6.0: &quot;Mobile Navigation &amp; Subposts&quot; </span> <span class="text-muted-foreground/80 text-xs"> 4 min read <span>  
(11 min read total)
</span> </span> </div>  </a> </li> <li class="ml-4 space-y-1"> <div class="text-foreground bg-muted subposts-sidebar-active-item flex items-center gap-2 rounded-md px-2 py-1.5 text-sm font-medium text-pretty"> <svg width="1em" height="1em" class="size-4 flex-shrink-0" aria-hidden="true" data-icon="lucide:file-text">   <symbol id="ai:lucide:file-text" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"/><path d="M14 2v4a2 2 0 0 0 2 2h4M10 9H8m8 4H8m8 4H8"/></g></symbol><use href="#ai:lucide:file-text"></use>  </svg> <div class="flex flex-col"> <span class="line-clamp-2 text-pretty"> Implementing sticky mobile navigation </span> <span class="text-muted-foreground/80 text-xs"> 5 min read </span> </div> </div><a href="/blog/mobile-nav-and-subposts/subposts" target="_self" class="duration-300 ease-in-out hover:text-foreground text-muted-foreground hover:bg-muted/50 subposts-sidebar-link flex items-center gap-2 rounded-md px-2 py-1.5 text-sm text-pretty transition-colors">  <svg width="1em" height="1em" class="size-4 flex-shrink-0" aria-hidden="true" data-icon="lucide:file">   <symbol id="ai:lucide:file" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"/><path d="M14 2v4a2 2 0 0 0 2 2h4"/></g></symbol><use href="#ai:lucide:file"></use>  </svg> <div class="flex flex-col"> <span class="line-clamp-2 text-pretty"> Implementing file-based subpost routing </span> <span class="text-muted-foreground/80 text-xs"> 3 min read </span> </div>  </a> </li> </ul> </div> </astro-slot></div></div></div><!--astro:end--></astro-island> </div> <script type="module">class u{scrollArea=null;sidebarScrollArea=null;reset(){this.scrollArea=null,this.sidebarScrollArea=null}}const e=new u;class n{static update(){if(!e.scrollArea||!e.sidebarScrollArea)return;const{scrollTop:t,scrollHeight:a,clientHeight:o}=e.scrollArea,r=5,c=t<=r,i=t>=a-o-r;e.sidebarScrollArea.classList.toggle("mask-t-from-90%",!c),e.sidebarScrollArea.classList.toggle("mask-b-from-90%",!i)}}class A{static toActive(){if(!e.scrollArea)return;const t=e.scrollArea.querySelector(".subposts-sidebar-active-item");if(!t)return;const{top:a,height:o}=e.scrollArea.getBoundingClientRect(),{top:r,height:c}=t.getBoundingClientRect(),i=r-a+e.scrollArea.scrollTop,d=Math.max(0,Math.min(i-(o-c)/2,e.scrollArea.scrollHeight-e.scrollArea.clientHeight));e.scrollArea.scrollTop=d}}class l{static init(){e.reset();const t=document.getElementById("subposts-sidebar-container");t&&(e.scrollArea=t.querySelector("[data-radix-scroll-area-viewport]"),e.sidebarScrollArea=t.querySelector("[data-subposts-sidebar-scroll]"),e.scrollArea&&e.scrollArea.addEventListener("scroll",n.update,{passive:!0}),requestAnimationFrame(()=>{A.toActive(),setTimeout(n.update,100)}))}static cleanup(){e.scrollArea&&e.scrollArea.removeEventListener("scroll",n.update),e.reset()}}document.addEventListener("astro:page-load",()=>l.init());document.addEventListener("astro:after-swap",()=>{l.cleanup(),l.init()});document.addEventListener("astro:before-swap",()=>l.cleanup());</script> <nav class="col-start-2 grid grid-cols-1 gap-4 sm:grid-cols-3"> <a href="#" target="_self" class="duration-300 ease-in-out gap-2 whitespace-nowrap text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&#38;_svg]:pointer-events-none [&#38;_svg:not([class*='size-'])]:size-4 shrink-0 [&#38;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive border bg-background hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50 px-4 py-2 has-[>svg]:px-3 rounded-lg group flex items-center justify-start size-full pointer-events-none opacity-50 cursor-not-allowed" aria-disabled="true">  <svg width="1em" height="1em" viewBox="0 0 24 24" class="mr-2 size-4 transition-transform group-hover:-translate-x-1" data-icon="lucide:arrow-left">   <use href="#ai:lucide:arrow-left"></use>  </svg> <div class="flex flex-col items-start overflow-hidden text-wrap"> <span class="text-muted-foreground text-left text-xs"> Previous Subpost </span> <span class="w-full text-left text-sm text-balance text-ellipsis"> No older subpost </span> </div>  </a> <a href="/blog/mobile-nav-and-subposts#post-title" target="_self" class="duration-300 ease-in-out gap-2 whitespace-nowrap text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&#38;_svg]:pointer-events-none [&#38;_svg:not([class*='size-'])]:size-4 shrink-0 [&#38;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive border bg-background hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50 px-4 py-2 has-[>svg]:px-3 group flex size-full items-center justify-center rounded-lg">  <svg width="1em" height="1em" viewBox="0 0 24 24" class="mr-2 size-4 transition-transform group-hover:-translate-y-1" data-icon="lucide:corner-left-up">   <use href="#ai:lucide:corner-left-up"></use>  </svg> <div class="flex flex-col items-center overflow-hidden text-wrap"> <span class="text-muted-foreground text-center text-xs">
Parent Post
</span> <span class="w-full text-center text-sm text-balance text-ellipsis"> v1.6.0: &quot;Mobile Navigation &amp; Subposts&quot; </span> </div>  </a> <a href="/blog/mobile-nav-and-subposts/subposts#post-title" target="_self" class="duration-300 ease-in-out gap-2 whitespace-nowrap text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&#38;_svg]:pointer-events-none [&#38;_svg:not([class*='size-'])]:size-4 shrink-0 [&#38;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive border bg-background hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50 px-4 py-2 has-[>svg]:px-3 rounded-lg group flex items-center justify-end size-full" aria-disabled="false">  <div class="flex flex-col items-end overflow-hidden text-wrap"> <span class="text-muted-foreground text-right text-xs"> Next Subpost </span> <span class="w-full text-right text-sm text-balance text-ellipsis"> Implementing file-based subpost routing </span> </div> <svg width="1em" height="1em" viewBox="0 0 24 24" class="ml-2 size-4 transition-transform group-hover:translate-x-1" data-icon="lucide:arrow-right">   <use href="#ai:lucide:arrow-right"></use>  </svg>  </a> </nav> </section> <button data-slot="button" class="items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive border bg-background hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50 size-9 group fixed right-8 bottom-8 z-50 hidden" id="scroll-to-top" title="Scroll to top" aria-label="Scroll to top"> <svg width="1em" height="1em" class="mx-auto size-4 transition-all group-hover:-translate-y-0.5" data-icon="lucide:arrow-up">   <symbol id="ai:lucide:arrow-up" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m5 12l7-7l7 7m-7 7V5"/></symbol><use href="#ai:lucide:arrow-up"></use>  </svg> </button> <script type="module">document.addEventListener("astro:page-load",()=>{const o=document.getElementById("scroll-to-top"),t=document.querySelector("footer");o&&t&&(o.addEventListener("click",()=>{window.scrollTo({top:0,behavior:"smooth"})}),window.addEventListener("scroll",()=>{const e=t.getBoundingClientRect().top<=window.innerHeight;o.classList.toggle("hidden",window.scrollY<=300||e)}))});</script>  </div> </main> <footer class="py-4"> <div class="mx-auto flex max-w-3xl flex-col items-center justify-center gap-y-2 px-4 sm:flex-row sm:justify-between"> <div class="flex flex-wrap items-center justify-center gap-x-2 text-center"> <span class="text-muted-foreground text-sm">
&copy; 2025 All rights reserved.
</span> <div data-orientation="vertical" role="none" data-slot="separator-root" class="bg-border shrink-0 data-[orientation=horizontal]:h-px data-[orientation=horizontal]:w-full data-[orientation=vertical]:h-full data-[orientation=vertical]:w-px hidden h-4! sm:block"></div> <p class="text-muted-foreground text-sm">
Made with 🤍 by <a href="https://github.com/wermos" target="_blank" class="inline-block transition-colors duration-300 ease-in-out underline decoration-muted-foreground underline-offset-[3px] hover:decoration-foreground text-foreground"> wermos </a>!
</p> </div> <ul class="flex flex-wrap gap-2" role="list"> <li> <a href="https://github.com/jktrn" target="_blank" class="duration-300 ease-in-out inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&#38;_svg]:pointer-events-none [&#38;_svg:not([class*='size-'])]:size-4 shrink-0 [&#38;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive border bg-background hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50 size-9" aria-label="GitHub" title="GitHub">  <svg width="1em" height="1em" class="size-4" data-icon="lucide:github">   <symbol id="ai:lucide:github" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5c.08-1.25-.27-2.48-1-3.5c.28-1.15.28-2.35 0-3.5c0 0-1 0-3 1.5c-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.4 5.4 0 0 0 4 9c0 3.5 3 5.5 6 5.5c-.39.49-.68 1.05-.85 1.65S8.93 17.38 9 18v4"/><path d="M9 18c-4.51 2-5-2-7-2"/></g></symbol><use href="#ai:lucide:github"></use>  </svg>  </a> </li><li> <a href="https://twitter.com/enscry" target="_blank" class="duration-300 ease-in-out inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&#38;_svg]:pointer-events-none [&#38;_svg:not([class*='size-'])]:size-4 shrink-0 [&#38;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive border bg-background hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50 size-9" aria-label="Twitter" title="Twitter">  <svg width="1em" height="1em" class="size-4" data-icon="lucide:twitter">   <symbol id="ai:lucide:twitter" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M22 4s-.7 2.1-2 3.4c1.6 10-9.4 17.3-18 11.6c2.2.1 4.4-.6 6-2C3 15.5.5 9.6 3 5c2.2 2.6 5.6 4.1 9 4c-.9-4.2 4-6.6 7-3.8c1.1 0 3-1.2 3-1.2"/></symbol><use href="#ai:lucide:twitter"></use>  </svg>  </a> </li><li> <a href="mailto:jason@enscribe.dev" target="_blank" class="duration-300 ease-in-out inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&#38;_svg]:pointer-events-none [&#38;_svg:not([class*='size-'])]:size-4 shrink-0 [&#38;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive border bg-background hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50 size-9" aria-label="Email" title="Email">  <svg width="1em" height="1em" class="size-4" data-icon="lucide:mail">   <symbol id="ai:lucide:mail" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="m22 7l-8.991 5.727a2 2 0 0 1-2.009 0L2 7"/><rect width="20" height="16" x="2" y="4" rx="2"/></g></symbol><use href="#ai:lucide:mail"></use>  </svg>  </a> </li><li> <a href="/rss.xml" target="_blank" class="duration-300 ease-in-out inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&#38;_svg]:pointer-events-none [&#38;_svg:not([class*='size-'])]:size-4 shrink-0 [&#38;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive border bg-background hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50 size-9" aria-label="RSS" title="RSS">  <svg width="1em" height="1em" class="size-4" data-icon="lucide:rss">   <symbol id="ai:lucide:rss" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M4 11a9 9 0 0 1 9 9M4 4a16 16 0 0 1 16 16"/><circle cx="5" cy="19" r="1"/></g></symbol><use href="#ai:lucide:rss"></use>  </svg>  </a> </li> </ul> </div> </footer> </div> </body></html>