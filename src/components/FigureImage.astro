---
import { Image } from 'astro:assets'
import { processCaption } from '@/lib/caption-processor'

interface FigureImageProps {
  caption?: string
  figureClass?: string
  captionClass?: string
  [key: string]: unknown
}

const {
  caption,
  figureClass,
  captionClass = 'text-center mt-2 text-sm text-muted-foreground',
  ...imageProps
} = Astro.props as FigureImageProps

const processedCaption = caption ? await processCaption(caption) : ''
---

<figure class={figureClass}>
  <Image {...imageProps as any} />
  {caption && <figcaption class={captionClass} set:html={processedCaption} />}
</figure>
