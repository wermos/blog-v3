---
import { Image } from 'astro:assets';
import { processCaption } from '@/lib/caption-processor'
import ImageGallery from '@/components/ImageGallery.astro';

export interface Props {
  images: Array<{
    src: ImageMetadata;
    alt?: string;
    caption?: string;
  }>;
  groupCaption?: string;
}

const { images, groupCaption } = Astro.props;

// Process captions for all images
const processedImages = await Promise.all(
  images.map(async (img) => ({
    src: img.src.src,
    alt: img.alt,
    caption: img.caption ? await processCaption(img.caption) : undefined
  }))
);

const processedGroupCaption = groupCaption ? await processCaption(groupCaption) : undefined;
---

<div class="not-prose mb-8">
  <!-- Use client:load to automatically hydrate each instance -->
  <ImageGallery 
    client:load
    images={processedImages} 
    groupCaption={processedGroupCaption}
  />
</div>
